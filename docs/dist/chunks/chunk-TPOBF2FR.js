import{a as W}from"./chunk-QK7BS6IW.js";import{b,e as y}from"./chunk-HJRTLFPM.js";import{d as M}from"./chunk-QBHXWPSD.js";var L=M(W(),1);var T=class{constructor(){this._cached=new Map;this._curFont="";let e=new OffscreenCanvas(0,0).getContext("2d");if(!e)throw new Error("OffscreenCanvas not supported");this._context=e}setFont(e,t){this._curFont!==`${t} ${e}`&&(this._curFont=`${t} ${e}`,this._context.font=`${t} ${e}`)}meatText(e){let t=`${e}_${this._curFont}`,r=this._cached.get(t);if(r)return r;let o=this._context.measureText(e).width;return this._cached.set(t,o),o}},D=(()=>{let s=null;return function(){return s||(s=new T),s}})();function R(s,e,t){let r=D();return r.setFont(e,t),r.meatText(s)}function _(s){return typeof s.value=="boolean"?s.value?"TRUE":"FALSE":s.value instanceof Date?"9999-99-99":s.text}var k=class{constructor(e){this.args=e}onBeforeDataProcess(e,t){}onAfterDataProcess(e,t){}};var F=11,$=10,N=.15;function A(s){return typeof s=="object"&&s!==null&&!(s instanceof Date)}var x=class extends k{constructor(e){var t,r,o,i,u,g,c,h,m;super({autoSizeColumns:(t=e.autoSizeColumns)!=null?t:!1,mainSheetName:(r=e.mainSheetName)!=null?r:"data",imageResources:(o=e.imageResources)!=null?o:[],imagesOnSheet:(i=e.imagesOnSheet)!=null?i:[],columnWidthList:(u=e.columnWidthList)!=null?u:[],commonStyle:(g=e.commonStyle)!=null?g:{},rowHeightList:(c=e.rowHeightList)!=null?c:[],columnStyle:(h=e.columnStyle)!=null?h:{},extraSheetList:(m=e.extraSheetList)!=null?m:[]})}_applyStyleAttrs(e,t){var u,g;let r=t.reduce((c,h)=>Math.max(c,h.length),0),o=this.args.commonStyle||{},i=t.length;for(let c=0;c<r;++c){let h=this.args.columnStyle[c],m=h?y(o||{},h):b(o||{}),a=Object.keys(m).length>0;for(let l=0;l<i;++l){let n=t[l][c],p=l+1,f=c+1,d=e.getCell(p,f);A(n)?(n.cellMerged&&e.mergeCells(p,f,l+((u=n.cellMerged.rowSpan)!=null?u:1),c+((g=n.cellMerged.colSpan)!=null?g:1)),n.style?d.style=y(m,n.style):a&&(d.style=m),n.comment&&(d.note=n.comment)):a&&(d.style=m)}}}_insertImages(e){this.args.imagesOnSheet.forEach(({imageNo:t,row:r,col:o,width:i,height:u})=>{e.addImage(t,{tl:{row:r,col:o},ext:{width:i,height:u}})})}addNewSheet(e,t,r){var m;let o=e.addWorksheet(r.mainSheetName),{columnWidthList:i=[],rowHeightList:u=[]}=r;(m=r.imageResources)==null||m.forEach(a=>e.addImage(a)),c(),this._applyStyleAttrs(o,t),this._insertImages(o),this.args.autoSizeColumns?g():i.forEach((a,l)=>o.getColumn(l+1).width=a),u.forEach((a,l)=>o.getRow(l+1).height=a);function g(){var l;let a=o.columns.length;for(let n=0;n<a;n++){let p=o.getColumn(n+1),f=(l=i[n+1])!=null?l:$;p.eachCell({includeEmpty:!1},d=>{var S,w,I,E;let O=`${(w=(S=d.font)==null?void 0:S.size)!=null?w:F}pt`,j=(E=(I=d.font)==null?void 0:I.name)!=null?E:"'Malgun Gothic'",v=R(_(d),j,O);f=Math.max(f,v*N)}),p.width=f}}function c(){t.forEach(a=>{let l=o.addRow(null);a.forEach((n,p)=>{let f=A(n)?n.value:n;h(f)||(l.getCell(p+1).value=f)})})}function h(a){return a==null}}export(e){var r;let t=new L.default.Workbook;return this.addNewSheet(t,e,this.args),(r=this.args.extraSheetList)==null||r.forEach(({data:o,args:i})=>this.addNewSheet(t,o,i)),this.onAfterDataProcess(t,e),t.xlsx.writeBuffer().then(o=>new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}))}};var C=[];function U(s){return s.format==="excel"}var P=(()=>{let s=!1;return async()=>{if(!s)for(s=!0;C.length;){let e=C.shift();try{U(e)&&new x(e.args).export(e.data).then(t=>{postMessage({taskId:e.taskId,objectURL:URL.createObjectURL(t),hasError:!1})}).catch(t=>{console.error("data-worker error",t),postMessage({taskId:e.taskId,hasError:!0,error:t,objectURL:""})})}catch(t){console.error("data-worker error",t),postMessage({taskId:e.taskId,hasError:!0,error:t,objectURL:""})}finally{s=!1}}}})();typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&(self.onmessage=s=>{let{command:e,taskItem:t}=s.data;if(e==="register-task-item")C.push(t),P();else throw console.error(`unknown command ${e}. Please check the docs`,t),new Error("unknown command")});var K=import.meta.url;export{K as a};
