import{a as hn,b as dn}from"./chunks/chunk-R7VWAK3S.js";import{a as sn}from"./chunks/chunk-SAP32CJ3.js";import{a as Ee,b as jr,f as ln}from"./chunks/chunk-HJRTLFPM.js";import{a as an,c as Or,d as cn,e as Cr,f as Sr}from"./chunks/chunk-4BHHVEMS.js";import{a as ke}from"./chunks/chunk-H64UOPIH.js";import"./chunks/chunk-ZSTOGUCC.js";import"./chunks/chunk-QOX5DKB2.js";import{c as ki}from"./chunks/chunk-QBHXWPSD.js";var Ei={value:()=>{}};function fn(){for(var r=0,t=arguments.length,e={},n;r<t;++r){if(!(n=arguments[r]+"")||n in e||/[\s.]/.test(n))throw new Error("illegal type: "+n);e[n]=[]}return new Me(e)}function Me(r){this._=r}function Mi(r,t){return r.trim().split(/^|\s+/).map(function(e){var n="",o=e.indexOf(".");if(o>=0&&(n=e.slice(o+1),e=e.slice(0,o)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}})}Me.prototype=fn.prototype={constructor:Me,on:function(r,t){var e=this._,n=Mi(r+"",e),o,i=-1,s=n.length;if(arguments.length<2){for(;++i<s;)if((o=(r=n[i]).type)&&(o=Ti(e[o],r.name)))return o;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++i<s;)if(o=(r=n[i]).type)e[o]=un(e[o],r.name,t);else if(t==null)for(o in e)e[o]=un(e[o],r.name,null);return this},copy:function(){var r={},t=this._;for(var e in t)r[e]=t[e].slice();return new Me(r)},call:function(r,t){if((o=arguments.length-2)>0)for(var e=new Array(o),n=0,o,i;n<o;++n)e[n]=arguments[n+2];if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(i=this._[r],n=0,o=i.length;n<o;++n)i[n].value.apply(t,e)},apply:function(r,t,e){if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(var n=this._[r],o=0,i=n.length;o<i;++o)n[o].value.apply(t,e)}};function Ti(r,t){for(var e=0,n=r.length,o;e<n;++e)if((o=r[e]).name===t)return o.value}function un(r,t,e){for(var n=0,o=r.length;n<o;++n)if(r[n].name===t){r[n]=Ei,r=r.slice(0,n).concat(r.slice(n+1));break}return e!=null&&r.push({name:t,value:e}),r}var wt=fn;var Te="http://www.w3.org/1999/xhtml",Ir={svg:"http://www.w3.org/2000/svg",xhtml:Te,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function lt(r){var t=r+="",e=t.indexOf(":");return e>=0&&(t=r.slice(0,e))!=="xmlns"&&(r=r.slice(e+1)),Ir.hasOwnProperty(t)?{space:Ir[t],local:r}:r}function Ai(r){return function(){var t=this.ownerDocument,e=this.namespaceURI;return e===Te&&t.documentElement.namespaceURI===Te?t.createElement(r):t.createElementNS(e,r)}}function Di(r){return function(){return this.ownerDocument.createElementNS(r.space,r.local)}}function Ae(r){var t=lt(r);return(t.local?Di:Ai)(t)}function zi(){}function vt(r){return r==null?zi:function(){return this.querySelector(r)}}function pn(r){typeof r!="function"&&(r=vt(r));for(var t=this._groups,e=t.length,n=new Array(e),o=0;o<e;++o)for(var i=t[o],s=i.length,a=n[o]=new Array(s),c,l,h=0;h<s;++h)(c=i[h])&&(l=r.call(c,c.__data__,h,i))&&("__data__"in c&&(l.__data__=c.__data__),a[h]=l);return new E(n,this._parents)}function kr(r){return r==null?[]:Array.isArray(r)?r:Array.from(r)}function Ni(){return[]}function Yt(r){return r==null?Ni:function(){return this.querySelectorAll(r)}}function Pi(r){return function(){return kr(r.apply(this,arguments))}}function gn(r){typeof r=="function"?r=Pi(r):r=Yt(r);for(var t=this._groups,e=t.length,n=[],o=[],i=0;i<e;++i)for(var s=t[i],a=s.length,c,l=0;l<a;++l)(c=s[l])&&(n.push(r.call(c,c.__data__,l,s)),o.push(c));return new E(n,o)}function Bt(r){return function(){return this.matches(r)}}function De(r){return function(t){return t.matches(r)}}var Ri=Array.prototype.find;function Li(r){return function(){return Ri.call(this.children,r)}}function $i(){return this.firstElementChild}function mn(r){return this.select(r==null?$i:Li(typeof r=="function"?r:De(r)))}var Fi=Array.prototype.filter;function Hi(){return Array.from(this.children)}function Xi(r){return function(){return Fi.call(this.children,r)}}function yn(r){return this.selectAll(r==null?Hi:Xi(typeof r=="function"?r:De(r)))}function bn(r){typeof r!="function"&&(r=Bt(r));for(var t=this._groups,e=t.length,n=new Array(e),o=0;o<e;++o)for(var i=t[o],s=i.length,a=n[o]=[],c,l=0;l<s;++l)(c=i[l])&&r.call(c,c.__data__,l,i)&&a.push(c);return new E(n,this._parents)}function ze(r){return new Array(r.length)}function xn(){return new E(this._enter||this._groups.map(ze),this._parents)}function Vt(r,t){this.ownerDocument=r.ownerDocument,this.namespaceURI=r.namespaceURI,this._next=null,this._parent=r,this.__data__=t}Vt.prototype={constructor:Vt,appendChild:function(r){return this._parent.insertBefore(r,this._next)},insertBefore:function(r,t){return this._parent.insertBefore(r,t)},querySelector:function(r){return this._parent.querySelector(r)},querySelectorAll:function(r){return this._parent.querySelectorAll(r)}};function _n(r){return function(){return r}}function Yi(r,t,e,n,o,i){for(var s=0,a,c=t.length,l=i.length;s<l;++s)(a=t[s])?(a.__data__=i[s],n[s]=a):e[s]=new Vt(r,i[s]);for(;s<c;++s)(a=t[s])&&(o[s]=a)}function Bi(r,t,e,n,o,i,s){var a,c,l=new Map,h=t.length,f=i.length,u=new Array(h),m;for(a=0;a<h;++a)(c=t[a])&&(u[a]=m=s.call(c,c.__data__,a,t)+"",l.has(m)?o[a]=c:l.set(m,c));for(a=0;a<f;++a)m=s.call(r,i[a],a,i)+"",(c=l.get(m))?(n[a]=c,c.__data__=i[a],l.delete(m)):e[a]=new Vt(r,i[a]);for(a=0;a<h;++a)(c=t[a])&&l.get(u[a])===c&&(o[a]=c)}function Vi(r){return r.__data__}function wn(r,t){if(!arguments.length)return Array.from(this,Vi);var e=t?Bi:Yi,n=this._parents,o=this._groups;typeof r!="function"&&(r=_n(r));for(var i=o.length,s=new Array(i),a=new Array(i),c=new Array(i),l=0;l<i;++l){var h=n[l],f=o[l],u=f.length,m=Ui(r.call(h,h&&h.__data__,l,n)),O=m.length,j=a[l]=new Array(O),A=s[l]=new Array(O),x=c[l]=new Array(u);e(h,f,j,A,x,m,t);for(var $=0,N=0,g,C;$<O;++$)if(g=j[$]){for($>=N&&(N=$+1);!(C=A[N])&&++N<O;);g._next=C||null}}return s=new E(s,n),s._enter=a,s._exit=c,s}function Ui(r){return typeof r=="object"&&"length"in r?r:Array.from(r)}function vn(){return new E(this._exit||this._groups.map(ze),this._parents)}function On(r,t,e){var n=this.enter(),o=this,i=this.exit();return typeof r=="function"?(n=r(n),n&&(n=n.selection())):n=n.append(r+""),t!=null&&(o=t(o),o&&(o=o.selection())),e==null?i.remove():e(i),n&&o?n.merge(o).order():o}function Cn(r){for(var t=r.selection?r.selection():r,e=this._groups,n=t._groups,o=e.length,i=n.length,s=Math.min(o,i),a=new Array(o),c=0;c<s;++c)for(var l=e[c],h=n[c],f=l.length,u=a[c]=new Array(f),m,O=0;O<f;++O)(m=l[O]||h[O])&&(u[O]=m);for(;c<o;++c)a[c]=e[c];return new E(a,this._parents)}function Sn(){for(var r=this._groups,t=-1,e=r.length;++t<e;)for(var n=r[t],o=n.length-1,i=n[o],s;--o>=0;)(s=n[o])&&(i&&s.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(s,i),i=s);return this}function jn(r){r||(r=Wi);function t(f,u){return f&&u?r(f.__data__,u.__data__):!f-!u}for(var e=this._groups,n=e.length,o=new Array(n),i=0;i<n;++i){for(var s=e[i],a=s.length,c=o[i]=new Array(a),l,h=0;h<a;++h)(l=s[h])&&(c[h]=l);c.sort(t)}return new E(o,this._parents).order()}function Wi(r,t){return r<t?-1:r>t?1:r>=t?0:NaN}function In(){var r=arguments[0];return arguments[0]=this,r.apply(null,arguments),this}function kn(){return Array.from(this)}function En(){for(var r=this._groups,t=0,e=r.length;t<e;++t)for(var n=r[t],o=0,i=n.length;o<i;++o){var s=n[o];if(s)return s}return null}function Mn(){let r=0;for(let t of this)++r;return r}function Tn(){return!this.node()}function An(r){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var o=t[e],i=0,s=o.length,a;i<s;++i)(a=o[i])&&r.call(a,a.__data__,i,o);return this}function Gi(r){return function(){this.removeAttribute(r)}}function qi(r){return function(){this.removeAttributeNS(r.space,r.local)}}function Ki(r,t){return function(){this.setAttribute(r,t)}}function Zi(r,t){return function(){this.setAttributeNS(r.space,r.local,t)}}function Ji(r,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttribute(r):this.setAttribute(r,e)}}function Qi(r,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttributeNS(r.space,r.local):this.setAttributeNS(r.space,r.local,e)}}function Dn(r,t){var e=lt(r);if(arguments.length<2){var n=this.node();return e.local?n.getAttributeNS(e.space,e.local):n.getAttribute(e)}return this.each((t==null?e.local?qi:Gi:typeof t=="function"?e.local?Qi:Ji:e.local?Zi:Ki)(e,t))}function Ne(r){return r.ownerDocument&&r.ownerDocument.defaultView||r.document&&r||r.defaultView}function ts(r){return function(){this.style.removeProperty(r)}}function es(r,t,e){return function(){this.style.setProperty(r,t,e)}}function rs(r,t,e){return function(){var n=t.apply(this,arguments);n==null?this.style.removeProperty(r):this.style.setProperty(r,n,e)}}function zn(r,t,e){return arguments.length>1?this.each((t==null?ts:typeof t=="function"?rs:es)(r,t,e==null?"":e)):ft(this.node(),r)}function ft(r,t){return r.style.getPropertyValue(t)||Ne(r).getComputedStyle(r,null).getPropertyValue(t)}function ns(r){return function(){delete this[r]}}function os(r,t){return function(){this[r]=t}}function is(r,t){return function(){var e=t.apply(this,arguments);e==null?delete this[r]:this[r]=e}}function Nn(r,t){return arguments.length>1?this.each((t==null?ns:typeof t=="function"?is:os)(r,t)):this.node()[r]}function Pn(r){return r.trim().split(/^|\s+/)}function Er(r){return r.classList||new Rn(r)}function Rn(r){this._node=r,this._names=Pn(r.getAttribute("class")||"")}Rn.prototype={add:function(r){var t=this._names.indexOf(r);t<0&&(this._names.push(r),this._node.setAttribute("class",this._names.join(" ")))},remove:function(r){var t=this._names.indexOf(r);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(r){return this._names.indexOf(r)>=0}};function Ln(r,t){for(var e=Er(r),n=-1,o=t.length;++n<o;)e.add(t[n])}function $n(r,t){for(var e=Er(r),n=-1,o=t.length;++n<o;)e.remove(t[n])}function ss(r){return function(){Ln(this,r)}}function as(r){return function(){$n(this,r)}}function cs(r,t){return function(){(t.apply(this,arguments)?Ln:$n)(this,r)}}function Fn(r,t){var e=Pn(r+"");if(arguments.length<2){for(var n=Er(this.node()),o=-1,i=e.length;++o<i;)if(!n.contains(e[o]))return!1;return!0}return this.each((typeof t=="function"?cs:t?ss:as)(e,t))}function ls(){this.textContent=""}function hs(r){return function(){this.textContent=r}}function ds(r){return function(){var t=r.apply(this,arguments);this.textContent=t==null?"":t}}function Hn(r){return arguments.length?this.each(r==null?ls:(typeof r=="function"?ds:hs)(r)):this.node().textContent}function us(){this.innerHTML=""}function fs(r){return function(){this.innerHTML=r}}function ps(r){return function(){var t=r.apply(this,arguments);this.innerHTML=t==null?"":t}}function Xn(r){return arguments.length?this.each(r==null?us:(typeof r=="function"?ps:fs)(r)):this.node().innerHTML}function gs(){this.nextSibling&&this.parentNode.appendChild(this)}function Yn(){return this.each(gs)}function ms(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Bn(){return this.each(ms)}function Vn(r){var t=typeof r=="function"?r:Ae(r);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function ys(){return null}function Un(r,t){var e=typeof r=="function"?r:Ae(r),n=t==null?ys:typeof t=="function"?t:vt(t);return this.select(function(){return this.insertBefore(e.apply(this,arguments),n.apply(this,arguments)||null)})}function bs(){var r=this.parentNode;r&&r.removeChild(this)}function Wn(){return this.each(bs)}function xs(){var r=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(r,this.nextSibling):r}function _s(){var r=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(r,this.nextSibling):r}function Gn(r){return this.select(r?_s:xs)}function qn(r){return arguments.length?this.property("__data__",r):this.node().__data__}function ws(r){return function(t){r.call(this,t,this.__data__)}}function vs(r){return r.trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}})}function Os(r){return function(){var t=this.__on;if(t){for(var e=0,n=-1,o=t.length,i;e<o;++e)i=t[e],(!r.type||i.type===r.type)&&i.name===r.name?this.removeEventListener(i.type,i.listener,i.options):t[++n]=i;++n?t.length=n:delete this.__on}}}function Cs(r,t,e){return function(){var n=this.__on,o,i=ws(t);if(n){for(var s=0,a=n.length;s<a;++s)if((o=n[s]).type===r.type&&o.name===r.name){this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=i,o.options=e),o.value=t;return}}this.addEventListener(r.type,i,e),o={type:r.type,name:r.name,value:t,listener:i,options:e},n?n.push(o):this.__on=[o]}}function Kn(r,t,e){var n=vs(r+""),o,i=n.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var c=0,l=a.length,h;c<l;++c)for(o=0,h=a[c];o<i;++o)if((s=n[o]).type===h.type&&s.name===h.name)return h.value}return}for(a=t?Cs:Os,o=0;o<i;++o)this.each(a(n[o],t,e));return this}function Zn(r,t,e){var n=Ne(r),o=n.CustomEvent;typeof o=="function"?o=new o(t,e):(o=n.document.createEvent("Event"),e?(o.initEvent(t,e.bubbles,e.cancelable),o.detail=e.detail):o.initEvent(t,!1,!1)),r.dispatchEvent(o)}function Ss(r,t){return function(){return Zn(this,r,t)}}function js(r,t){return function(){return Zn(this,r,t.apply(this,arguments))}}function Jn(r,t){return this.each((typeof t=="function"?js:Ss)(r,t))}function*Qn(){for(var r=this._groups,t=0,e=r.length;t<e;++t)for(var n=r[t],o=0,i=n.length,s;o<i;++o)(s=n[o])&&(yield s)}var Mr=[null];function E(r,t){this._groups=r,this._parents=t}function to(){return new E([[document.documentElement]],Mr)}function Is(){return this}E.prototype=to.prototype={constructor:E,select:pn,selectAll:gn,selectChild:mn,selectChildren:yn,filter:bn,data:wn,enter:xn,exit:vn,join:On,merge:Cn,selection:Is,order:Sn,sort:jn,call:In,nodes:kn,node:En,size:Mn,empty:Tn,each:An,attr:Dn,style:zn,property:Nn,classed:Fn,text:Hn,html:Xn,raise:Yn,lower:Bn,append:Vn,insert:Un,remove:Wn,clone:Gn,datum:qn,on:Kn,dispatch:Jn,[Symbol.iterator]:Qn};var ht=to;function F(r){return typeof r=="string"?new E([[document.querySelector(r)]],[document.documentElement]):new E([[r]],Mr)}function eo(r){let t;for(;t=r.sourceEvent;)r=t;return r}function G(r,t){if(r=eo(r),t===void 0&&(t=r.currentTarget),t){var e=t.ownerSVGElement||t;if(e.createSVGPoint){var n=e.createSVGPoint();return n.x=r.clientX,n.y=r.clientY,n=n.matrixTransform(t.getScreenCTM().inverse()),[n.x,n.y]}if(t.getBoundingClientRect){var o=t.getBoundingClientRect();return[r.clientX-o.left-t.clientLeft,r.clientY-o.top-t.clientTop]}}return[r.pageX,r.pageY]}var ro={passive:!1},Ot={capture:!0,passive:!1};function Pe(r){r.stopImmediatePropagation()}function pt(r){r.preventDefault(),r.stopImmediatePropagation()}function Ut(r){var t=r.document.documentElement,e=F(r).on("dragstart.drag",pt,Ot);"onselectstart"in t?e.on("selectstart.drag",pt,Ot):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Wt(r,t){var e=r.document.documentElement,n=F(r).on("dragstart.drag",null);t&&(n.on("click.drag",pt,Ot),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in e?n.on("selectstart.drag",null):(e.style.MozUserSelect=e.__noselect,delete e.__noselect)}var Gt=r=>()=>r;function qt(r,{sourceEvent:t,subject:e,target:n,identifier:o,active:i,x:s,y:a,dx:c,dy:l,dispatch:h}){Object.defineProperties(this,{type:{value:r,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},identifier:{value:o,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:l,enumerable:!0,configurable:!0},_:{value:h}})}qt.prototype.on=function(){var r=this._.on.apply(this._,arguments);return r===this._?this:r};function ks(r){return!r.ctrlKey&&!r.button}function Es(){return this.parentNode}function Ms(r,t){return t==null?{x:r.x,y:r.y}:t}function Ts(){return navigator.maxTouchPoints||"ontouchstart"in this}function q(){var r=ks,t=Es,e=Ms,n=Ts,o={},i=wt("start","drag","end"),s=0,a,c,l,h,f=0;function u(g){g.on("mousedown.drag",m).filter(n).on("touchstart.drag",A).on("touchmove.drag",x,ro).on("touchend.drag touchcancel.drag",$).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function m(g,C){if(!(h||!r.call(this,g,C))){var S=N(this,t.call(this,g,C),g,C,"mouse");S&&(F(g.view).on("mousemove.drag",O,Ot).on("mouseup.drag",j,Ot),Ut(g.view),Pe(g),l=!1,a=g.clientX,c=g.clientY,S("start",g))}}function O(g){if(pt(g),!l){var C=g.clientX-a,S=g.clientY-c;l=C*C+S*S>f}o.mouse("drag",g)}function j(g){F(g.view).on("mousemove.drag mouseup.drag",null),Wt(g.view,l),pt(g),o.mouse("end",g)}function A(g,C){if(r.call(this,g,C)){var S=g.changedTouches,k=t.call(this,g,C),P=S.length,U,J;for(U=0;U<P;++U)(J=N(this,k,g,C,S[U].identifier,S[U]))&&(Pe(g),J("start",g,S[U]))}}function x(g){var C=g.changedTouches,S=C.length,k,P;for(k=0;k<S;++k)(P=o[C[k].identifier])&&(pt(g),P("drag",g,C[k]))}function $(g){var C=g.changedTouches,S=C.length,k,P;for(h&&clearTimeout(h),h=setTimeout(function(){h=null},500),k=0;k<S;++k)(P=o[C[k].identifier])&&(Pe(g),P("end",g,C[k]))}function N(g,C,S,k,P,U){var J=i.copy(),W=G(U||S,C),je,Ie,d;if((d=e.call(g,new qt("beforestart",{sourceEvent:S,target:u,identifier:P,active:s,x:W[0],y:W[1],dx:0,dy:0,dispatch:J}),k))!=null)return je=d.x-W[0]||0,Ie=d.y-W[1]||0,function y(p,b,_){var w=W,v;switch(p){case"start":o[P]=y,v=s++;break;case"end":delete o[P],--s;case"drag":W=G(_||b,C),v=s;break}J.call(p,g,new qt(p,{sourceEvent:b,subject:d,target:u,identifier:P,active:v,x:W[0]+je,y:W[1]+Ie,dx:W[0]-w[0],dy:W[1]-w[1],dispatch:J}),k)}}return u.filter=function(g){return arguments.length?(r=typeof g=="function"?g:Gt(!!g),u):r},u.container=function(g){return arguments.length?(t=typeof g=="function"?g:Gt(g),u):t},u.subject=function(g){return arguments.length?(e=typeof g=="function"?g:Gt(g),u):e},u.touchable=function(g){return arguments.length?(n=typeof g=="function"?g:Gt(!!g),u):n},u.on=function(){var g=i.on.apply(i,arguments);return g===i?u:g},u.clickDistance=function(g){return arguments.length?(f=(g=+g)*g,u):Math.sqrt(f)},u}function Re(r,t,e){r.prototype=t.prototype=e,e.constructor=r}function Tr(r,t){var e=Object.create(r.prototype);for(var n in t)e[n]=t[n];return e}function Jt(){}var Kt=.7,Fe=1/Kt,At="\\s*([+-]?\\d+)\\s*",Zt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",it="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",As=/^#([0-9a-f]{3,8})$/,Ds=new RegExp(`^rgb\\(${At},${At},${At}\\)$`),zs=new RegExp(`^rgb\\(${it},${it},${it}\\)$`),Ns=new RegExp(`^rgba\\(${At},${At},${At},${Zt}\\)$`),Ps=new RegExp(`^rgba\\(${it},${it},${it},${Zt}\\)$`),Rs=new RegExp(`^hsl\\(${Zt},${it},${it}\\)$`),Ls=new RegExp(`^hsla\\(${Zt},${it},${it},${Zt}\\)$`),no={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Re(Jt,gt,{copy(r){return Object.assign(new this.constructor,this,r)},displayable(){return this.rgb().displayable()},hex:oo,formatHex:oo,formatHex8:$s,formatHsl:Fs,formatRgb:io,toString:io});function oo(){return this.rgb().formatHex()}function $s(){return this.rgb().formatHex8()}function Fs(){return uo(this).formatHsl()}function io(){return this.rgb().formatRgb()}function gt(r){var t,e;return r=(r+"").trim().toLowerCase(),(t=As.exec(r))?(e=t[1].length,t=parseInt(t[1],16),e===6?so(t):e===3?new B(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):e===8?Le(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):e===4?Le(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Ds.exec(r))?new B(t[1],t[2],t[3],1):(t=zs.exec(r))?new B(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Ns.exec(r))?Le(t[1],t[2],t[3],t[4]):(t=Ps.exec(r))?Le(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Rs.exec(r))?lo(t[1],t[2]/100,t[3]/100,1):(t=Ls.exec(r))?lo(t[1],t[2]/100,t[3]/100,t[4]):no.hasOwnProperty(r)?so(no[r]):r==="transparent"?new B(NaN,NaN,NaN,0):null}function so(r){return new B(r>>16&255,r>>8&255,r&255,1)}function Le(r,t,e,n){return n<=0&&(r=t=e=NaN),new B(r,t,e,n)}function Hs(r){return r instanceof Jt||(r=gt(r)),r?(r=r.rgb(),new B(r.r,r.g,r.b,r.opacity)):new B}function Dt(r,t,e,n){return arguments.length===1?Hs(r):new B(r,t,e,n==null?1:n)}function B(r,t,e,n){this.r=+r,this.g=+t,this.b=+e,this.opacity=+n}Re(B,Dt,Tr(Jt,{brighter(r){return r=r==null?Fe:Math.pow(Fe,r),new B(this.r*r,this.g*r,this.b*r,this.opacity)},darker(r){return r=r==null?Kt:Math.pow(Kt,r),new B(this.r*r,this.g*r,this.b*r,this.opacity)},rgb(){return this},clamp(){return new B(St(this.r),St(this.g),St(this.b),He(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ao,formatHex:ao,formatHex8:Xs,formatRgb:co,toString:co}));function ao(){return`#${Ct(this.r)}${Ct(this.g)}${Ct(this.b)}`}function Xs(){return`#${Ct(this.r)}${Ct(this.g)}${Ct(this.b)}${Ct((isNaN(this.opacity)?1:this.opacity)*255)}`}function co(){let r=He(this.opacity);return`${r===1?"rgb(":"rgba("}${St(this.r)}, ${St(this.g)}, ${St(this.b)}${r===1?")":`, ${r})`}`}function He(r){return isNaN(r)?1:Math.max(0,Math.min(1,r))}function St(r){return Math.max(0,Math.min(255,Math.round(r)||0))}function Ct(r){return r=St(r),(r<16?"0":"")+r.toString(16)}function lo(r,t,e,n){return n<=0?r=t=e=NaN:e<=0||e>=1?r=t=NaN:t<=0&&(r=NaN),new et(r,t,e,n)}function uo(r){if(r instanceof et)return new et(r.h,r.s,r.l,r.opacity);if(r instanceof Jt||(r=gt(r)),!r)return new et;if(r instanceof et)return r;r=r.rgb();var t=r.r/255,e=r.g/255,n=r.b/255,o=Math.min(t,e,n),i=Math.max(t,e,n),s=NaN,a=i-o,c=(i+o)/2;return a?(t===i?s=(e-n)/a+(e<n)*6:e===i?s=(n-t)/a+2:s=(t-e)/a+4,a/=c<.5?i+o:2-i-o,s*=60):a=c>0&&c<1?0:s,new et(s,a,c,r.opacity)}function fo(r,t,e,n){return arguments.length===1?uo(r):new et(r,t,e,n==null?1:n)}function et(r,t,e,n){this.h=+r,this.s=+t,this.l=+e,this.opacity=+n}Re(et,fo,Tr(Jt,{brighter(r){return r=r==null?Fe:Math.pow(Fe,r),new et(this.h,this.s,this.l*r,this.opacity)},darker(r){return r=r==null?Kt:Math.pow(Kt,r),new et(this.h,this.s,this.l*r,this.opacity)},rgb(){var r=this.h%360+(this.h<0)*360,t=isNaN(r)||isNaN(this.s)?0:this.s,e=this.l,n=e+(e<.5?e:1-e)*t,o=2*e-n;return new B(Ar(r>=240?r-240:r+120,o,n),Ar(r,o,n),Ar(r<120?r+240:r-120,o,n),this.opacity)},clamp(){return new et(ho(this.h),$e(this.s),$e(this.l),He(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let r=He(this.opacity);return`${r===1?"hsl(":"hsla("}${ho(this.h)}, ${$e(this.s)*100}%, ${$e(this.l)*100}%${r===1?")":`, ${r})`}`}}));function ho(r){return r=(r||0)%360,r<0?r+360:r}function $e(r){return Math.max(0,Math.min(1,r||0))}function Ar(r,t,e){return(r<60?t+(e-t)*r/60:r<180?e:r<240?t+(e-t)*(240-r)/60:t)*255}function Dr(r,t,e,n,o){var i=r*r,s=i*r;return((1-3*r+3*i-s)*t+(4-6*i+3*s)*e+(1+3*r+3*i-3*s)*n+s*o)/6}function po(r){var t=r.length-1;return function(e){var n=e<=0?e=0:e>=1?(e=1,t-1):Math.floor(e*t),o=r[n],i=r[n+1],s=n>0?r[n-1]:2*o-i,a=n<t-1?r[n+2]:2*i-o;return Dr((e-n/t)*t,s,o,i,a)}}function go(r){var t=r.length;return function(e){var n=Math.floor(((e%=1)<0?++e:e)*t),o=r[(n+t-1)%t],i=r[n%t],s=r[(n+1)%t],a=r[(n+2)%t];return Dr((e-n/t)*t,o,i,s,a)}}var zr=r=>()=>r;function Ys(r,t){return function(e){return r+e*t}}function Bs(r,t,e){return r=Math.pow(r,e),t=Math.pow(t,e)-r,e=1/e,function(n){return Math.pow(r+n*t,e)}}function mo(r){return(r=+r)==1?Xe:function(t,e){return e-t?Bs(t,e,r):zr(isNaN(t)?e:t)}}function Xe(r,t){var e=t-r;return e?Ys(r,e):zr(isNaN(r)?t:r)}var Ye=function r(t){var e=mo(t);function n(o,i){var s=e((o=Dt(o)).r,(i=Dt(i)).r),a=e(o.g,i.g),c=e(o.b,i.b),l=Xe(o.opacity,i.opacity);return function(h){return o.r=s(h),o.g=a(h),o.b=c(h),o.opacity=l(h),o+""}}return n.gamma=r,n}(1);function yo(r){return function(t){var e=t.length,n=new Array(e),o=new Array(e),i=new Array(e),s,a;for(s=0;s<e;++s)a=Dt(t[s]),n[s]=a.r||0,o[s]=a.g||0,i[s]=a.b||0;return n=r(n),o=r(o),i=r(i),a.opacity=1,function(c){return a.r=n(c),a.g=o(c),a.b=i(c),a+""}}}var Vs=yo(po),Us=yo(go);function K(r,t){return r=+r,t=+t,function(e){return r*(1-e)+t*e}}var Pr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Nr=new RegExp(Pr.source,"g");function Ws(r){return function(){return r}}function Gs(r){return function(t){return r(t)+""}}function Rr(r,t){var e=Pr.lastIndex=Nr.lastIndex=0,n,o,i,s=-1,a=[],c=[];for(r=r+"",t=t+"";(n=Pr.exec(r))&&(o=Nr.exec(t));)(i=o.index)>e&&(i=t.slice(e,i),a[s]?a[s]+=i:a[++s]=i),(n=n[0])===(o=o[0])?a[s]?a[s]+=o:a[++s]=o:(a[++s]=null,c.push({i:s,x:K(n,o)})),e=Nr.lastIndex;return e<t.length&&(i=t.slice(e),a[s]?a[s]+=i:a[++s]=i),a.length<2?c[0]?Gs(c[0].x):Ws(t):(t=c.length,function(l){for(var h=0,f;h<t;++h)a[(f=c[h]).i]=f.x(l);return a.join("")})}var bo=180/Math.PI,Be={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Lr(r,t,e,n,o,i){var s,a,c;return(s=Math.sqrt(r*r+t*t))&&(r/=s,t/=s),(c=r*e+t*n)&&(e-=r*c,n-=t*c),(a=Math.sqrt(e*e+n*n))&&(e/=a,n/=a,c/=a),r*n<t*e&&(r=-r,t=-t,c=-c,s=-s),{translateX:o,translateY:i,rotate:Math.atan2(t,r)*bo,skewX:Math.atan(c)*bo,scaleX:s,scaleY:a}}var Ve;function xo(r){let t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(r+"");return t.isIdentity?Be:Lr(t.a,t.b,t.c,t.d,t.e,t.f)}function _o(r){return r==null?Be:(Ve||(Ve=document.createElementNS("http://www.w3.org/2000/svg","g")),Ve.setAttribute("transform",r),(r=Ve.transform.baseVal.consolidate())?(r=r.matrix,Lr(r.a,r.b,r.c,r.d,r.e,r.f)):Be)}function wo(r,t,e,n){function o(l){return l.length?l.pop()+" ":""}function i(l,h,f,u,m,O){if(l!==f||h!==u){var j=m.push("translate(",null,t,null,e);O.push({i:j-4,x:K(l,f)},{i:j-2,x:K(h,u)})}else(f||u)&&m.push("translate("+f+t+u+e)}function s(l,h,f,u){l!==h?(l-h>180?h+=360:h-l>180&&(l+=360),u.push({i:f.push(o(f)+"rotate(",null,n)-2,x:K(l,h)})):h&&f.push(o(f)+"rotate("+h+n)}function a(l,h,f,u){l!==h?u.push({i:f.push(o(f)+"skewX(",null,n)-2,x:K(l,h)}):h&&f.push(o(f)+"skewX("+h+n)}function c(l,h,f,u,m,O){if(l!==f||h!==u){var j=m.push(o(m)+"scale(",null,",",null,")");O.push({i:j-4,x:K(l,f)},{i:j-2,x:K(h,u)})}else(f!==1||u!==1)&&m.push(o(m)+"scale("+f+","+u+")")}return function(l,h){var f=[],u=[];return l=r(l),h=r(h),i(l.translateX,l.translateY,h.translateX,h.translateY,f,u),s(l.rotate,h.rotate,f,u),a(l.skewX,h.skewX,f,u),c(l.scaleX,l.scaleY,h.scaleX,h.scaleY,f,u),l=h=null,function(m){for(var O=-1,j=u.length,A;++O<j;)f[(A=u[O]).i]=A.x(m);return f.join("")}}}var $r=wo(xo,"px, ","px)","deg)"),Fr=wo(_o,", ",")",")");var qs=1e-12;function vo(r){return((r=Math.exp(r))+1/r)/2}function Ks(r){return((r=Math.exp(r))-1/r)/2}function Zs(r){return((r=Math.exp(2*r))-1)/(r+1)}var Hr=function r(t,e,n){function o(i,s){var a=i[0],c=i[1],l=i[2],h=s[0],f=s[1],u=s[2],m=h-a,O=f-c,j=m*m+O*O,A,x;if(j<qs)x=Math.log(u/l)/t,A=function(k){return[a+k*m,c+k*O,l*Math.exp(t*k*x)]};else{var $=Math.sqrt(j),N=(u*u-l*l+n*j)/(2*l*e*$),g=(u*u-l*l-n*j)/(2*u*e*$),C=Math.log(Math.sqrt(N*N+1)-N),S=Math.log(Math.sqrt(g*g+1)-g);x=(S-C)/t,A=function(k){var P=k*x,U=vo(C),J=l/(e*$)*(U*Zs(t*P+C)-Ks(C));return[a+J*m,c+J*O,l*U/vo(t*P+C)]}}return A.duration=x*1e3*t/Math.SQRT2,A}return o.rho=function(i){var s=Math.max(.001,+i),a=s*s,c=a*a;return r(s,a,c)},o}(Math.SQRT2,2,4);var zt=0,te=0,Qt=0,Co=1e3,Ue,ee,We=0,jt=0,Ge=0,re=typeof performance=="object"&&performance.now?performance:Date,So=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(r){setTimeout(r,17)};function oe(){return jt||(So(Js),jt=re.now()+Ge)}function Js(){jt=0}function ne(){this._call=this._time=this._next=null}ne.prototype=qe.prototype={constructor:ne,restart:function(r,t,e){if(typeof r!="function")throw new TypeError("callback is not a function");e=(e==null?oe():+e)+(t==null?0:+t),!this._next&&ee!==this&&(ee?ee._next=this:Ue=this,ee=this),this._call=r,this._time=e,Xr()},stop:function(){this._call&&(this._call=null,this._time=1/0,Xr())}};function qe(r,t,e){var n=new ne;return n.restart(r,t,e),n}function jo(){oe(),++zt;for(var r=Ue,t;r;)(t=jt-r._time)>=0&&r._call.call(void 0,t),r=r._next;--zt}function Oo(){jt=(We=re.now())+Ge,zt=te=0;try{jo()}finally{zt=0,ta(),jt=0}}function Qs(){var r=re.now(),t=r-We;t>Co&&(Ge-=t,We=r)}function ta(){for(var r,t=Ue,e,n=1/0;t;)t._call?(n>t._time&&(n=t._time),r=t,t=t._next):(e=t._next,t._next=null,t=r?r._next=e:Ue=e);ee=r,Xr(n)}function Xr(r){if(!zt){te&&(te=clearTimeout(te));var t=r-jt;t>24?(r<1/0&&(te=setTimeout(Oo,r-re.now()-Ge)),Qt&&(Qt=clearInterval(Qt))):(Qt||(We=re.now(),Qt=setInterval(Qs,Co)),zt=1,So(Oo))}}function It(r,t,e){var n=new ne;return t=t==null?0:+t,n.restart(o=>{n.stop(),r(o+t)},t,e),n}var ea=wt("start","end","cancel","interrupt"),ra=[],Eo=0,Io=1,Ze=2,Ke=3,ko=4,Je=5,ie=6;function mt(r,t,e,n,o,i){var s=r.__transition;if(!s)r.__transition={};else if(e in s)return;na(r,e,{name:t,index:n,group:o,on:ea,tween:ra,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:Eo})}function se(r,t){var e=T(r,t);if(e.state>Eo)throw new Error("too late; already scheduled");return e}function L(r,t){var e=T(r,t);if(e.state>Ke)throw new Error("too late; already running");return e}function T(r,t){var e=r.__transition;if(!e||!(e=e[t]))throw new Error("transition not found");return e}function na(r,t,e){var n=r.__transition,o;n[t]=e,e.timer=qe(i,0,e.time);function i(l){e.state=Io,e.timer.restart(s,e.delay,e.time),e.delay<=l&&s(l-e.delay)}function s(l){var h,f,u,m;if(e.state!==Io)return c();for(h in n)if(m=n[h],m.name===e.name){if(m.state===Ke)return It(s);m.state===ko?(m.state=ie,m.timer.stop(),m.on.call("interrupt",r,r.__data__,m.index,m.group),delete n[h]):+h<t&&(m.state=ie,m.timer.stop(),m.on.call("cancel",r,r.__data__,m.index,m.group),delete n[h])}if(It(function(){e.state===Ke&&(e.state=ko,e.timer.restart(a,e.delay,e.time),a(l))}),e.state=Ze,e.on.call("start",r,r.__data__,e.index,e.group),e.state===Ze){for(e.state=Ke,o=new Array(u=e.tween.length),h=0,f=-1;h<u;++h)(m=e.tween[h].value.call(r,r.__data__,e.index,e.group))&&(o[++f]=m);o.length=f+1}}function a(l){for(var h=l<e.duration?e.ease.call(null,l/e.duration):(e.timer.restart(c),e.state=Je,1),f=-1,u=o.length;++f<u;)o[f].call(r,h);e.state===Je&&(e.on.call("end",r,r.__data__,e.index,e.group),c())}function c(){e.state=ie,e.timer.stop(),delete n[t];for(var l in n)return;delete r.__transition}}function yt(r,t){var e=r.__transition,n,o,i=!0,s;if(e){t=t==null?null:t+"";for(s in e){if((n=e[s]).name!==t){i=!1;continue}o=n.state>Ze&&n.state<Je,n.state=ie,n.timer.stop(),n.on.call(o?"interrupt":"cancel",r,r.__data__,n.index,n.group),delete e[s]}i&&delete r.__transition}}function Mo(r){return this.each(function(){yt(this,r)})}function oa(r,t){var e,n;return function(){var o=L(this,r),i=o.tween;if(i!==e){n=e=i;for(var s=0,a=n.length;s<a;++s)if(n[s].name===t){n=n.slice(),n.splice(s,1);break}}o.tween=n}}function ia(r,t,e){var n,o;if(typeof e!="function")throw new Error;return function(){var i=L(this,r),s=i.tween;if(s!==n){o=(n=s).slice();for(var a={name:t,value:e},c=0,l=o.length;c<l;++c)if(o[c].name===t){o[c]=a;break}c===l&&o.push(a)}i.tween=o}}function To(r,t){var e=this._id;if(r+="",arguments.length<2){for(var n=T(this.node(),e).tween,o=0,i=n.length,s;o<i;++o)if((s=n[o]).name===r)return s.value;return null}return this.each((t==null?oa:ia)(e,r,t))}function Nt(r,t,e){var n=r._id;return r.each(function(){var o=L(this,n);(o.value||(o.value={}))[t]=e.apply(this,arguments)}),function(o){return T(o,n).value[t]}}function Qe(r,t){var e;return(typeof t=="number"?K:t instanceof gt?Ye:(e=gt(t))?(t=e,Ye):Rr)(r,t)}function sa(r){return function(){this.removeAttribute(r)}}function aa(r){return function(){this.removeAttributeNS(r.space,r.local)}}function ca(r,t,e){var n,o=e+"",i;return function(){var s=this.getAttribute(r);return s===o?null:s===n?i:i=t(n=s,e)}}function la(r,t,e){var n,o=e+"",i;return function(){var s=this.getAttributeNS(r.space,r.local);return s===o?null:s===n?i:i=t(n=s,e)}}function ha(r,t,e){var n,o,i;return function(){var s,a=e(this),c;return a==null?void this.removeAttribute(r):(s=this.getAttribute(r),c=a+"",s===c?null:s===n&&c===o?i:(o=c,i=t(n=s,a)))}}function da(r,t,e){var n,o,i;return function(){var s,a=e(this),c;return a==null?void this.removeAttributeNS(r.space,r.local):(s=this.getAttributeNS(r.space,r.local),c=a+"",s===c?null:s===n&&c===o?i:(o=c,i=t(n=s,a)))}}function Ao(r,t){var e=lt(r),n=e==="transform"?Fr:Qe;return this.attrTween(r,typeof t=="function"?(e.local?da:ha)(e,n,Nt(this,"attr."+r,t)):t==null?(e.local?aa:sa)(e):(e.local?la:ca)(e,n,t))}function ua(r,t){return function(e){this.setAttribute(r,t.call(this,e))}}function fa(r,t){return function(e){this.setAttributeNS(r.space,r.local,t.call(this,e))}}function pa(r,t){var e,n;function o(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&fa(r,i)),e}return o._value=t,o}function ga(r,t){var e,n;function o(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&ua(r,i)),e}return o._value=t,o}function Do(r,t){var e="attr."+r;if(arguments.length<2)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;var n=lt(r);return this.tween(e,(n.local?pa:ga)(n,t))}function ma(r,t){return function(){se(this,r).delay=+t.apply(this,arguments)}}function ya(r,t){return t=+t,function(){se(this,r).delay=t}}function zo(r){var t=this._id;return arguments.length?this.each((typeof r=="function"?ma:ya)(t,r)):T(this.node(),t).delay}function ba(r,t){return function(){L(this,r).duration=+t.apply(this,arguments)}}function xa(r,t){return t=+t,function(){L(this,r).duration=t}}function No(r){var t=this._id;return arguments.length?this.each((typeof r=="function"?ba:xa)(t,r)):T(this.node(),t).duration}function _a(r,t){if(typeof t!="function")throw new Error;return function(){L(this,r).ease=t}}function Po(r){var t=this._id;return arguments.length?this.each(_a(t,r)):T(this.node(),t).ease}function wa(r,t){return function(){var e=t.apply(this,arguments);if(typeof e!="function")throw new Error;L(this,r).ease=e}}function Ro(r){if(typeof r!="function")throw new Error;return this.each(wa(this._id,r))}function Lo(r){typeof r!="function"&&(r=Bt(r));for(var t=this._groups,e=t.length,n=new Array(e),o=0;o<e;++o)for(var i=t[o],s=i.length,a=n[o]=[],c,l=0;l<s;++l)(c=i[l])&&r.call(c,c.__data__,l,i)&&a.push(c);return new H(n,this._parents,this._name,this._id)}function $o(r){if(r._id!==this._id)throw new Error;for(var t=this._groups,e=r._groups,n=t.length,o=e.length,i=Math.min(n,o),s=new Array(n),a=0;a<i;++a)for(var c=t[a],l=e[a],h=c.length,f=s[a]=new Array(h),u,m=0;m<h;++m)(u=c[m]||l[m])&&(f[m]=u);for(;a<n;++a)s[a]=t[a];return new H(s,this._parents,this._name,this._id)}function va(r){return(r+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||t==="start"})}function Oa(r,t,e){var n,o,i=va(t)?se:L;return function(){var s=i(this,r),a=s.on;a!==n&&(o=(n=a).copy()).on(t,e),s.on=o}}function Fo(r,t){var e=this._id;return arguments.length<2?T(this.node(),e).on.on(r):this.each(Oa(e,r,t))}function Ca(r){return function(){var t=this.parentNode;for(var e in this.__transition)if(+e!==r)return;t&&t.removeChild(this)}}function Ho(){return this.on("end.remove",Ca(this._id))}function Xo(r){var t=this._name,e=this._id;typeof r!="function"&&(r=vt(r));for(var n=this._groups,o=n.length,i=new Array(o),s=0;s<o;++s)for(var a=n[s],c=a.length,l=i[s]=new Array(c),h,f,u=0;u<c;++u)(h=a[u])&&(f=r.call(h,h.__data__,u,a))&&("__data__"in h&&(f.__data__=h.__data__),l[u]=f,mt(l[u],t,e,u,l,T(h,e)));return new H(i,this._parents,t,e)}function Yo(r){var t=this._name,e=this._id;typeof r!="function"&&(r=Yt(r));for(var n=this._groups,o=n.length,i=[],s=[],a=0;a<o;++a)for(var c=n[a],l=c.length,h,f=0;f<l;++f)if(h=c[f]){for(var u=r.call(h,h.__data__,f,c),m,O=T(h,e),j=0,A=u.length;j<A;++j)(m=u[j])&&mt(m,t,e,j,u,O);i.push(u),s.push(h)}return new H(i,s,t,e)}var Sa=ht.prototype.constructor;function Bo(){return new Sa(this._groups,this._parents)}function ja(r,t){var e,n,o;return function(){var i=ft(this,r),s=(this.style.removeProperty(r),ft(this,r));return i===s?null:i===e&&s===n?o:o=t(e=i,n=s)}}function Vo(r){return function(){this.style.removeProperty(r)}}function Ia(r,t,e){var n,o=e+"",i;return function(){var s=ft(this,r);return s===o?null:s===n?i:i=t(n=s,e)}}function ka(r,t,e){var n,o,i;return function(){var s=ft(this,r),a=e(this),c=a+"";return a==null&&(c=a=(this.style.removeProperty(r),ft(this,r))),s===c?null:s===n&&c===o?i:(o=c,i=t(n=s,a))}}function Ea(r,t){var e,n,o,i="style."+t,s="end."+i,a;return function(){var c=L(this,r),l=c.on,h=c.value[i]==null?a||(a=Vo(t)):void 0;(l!==e||o!==h)&&(n=(e=l).copy()).on(s,o=h),c.on=n}}function Uo(r,t,e){var n=(r+="")=="transform"?$r:Qe;return t==null?this.styleTween(r,ja(r,n)).on("end.style."+r,Vo(r)):typeof t=="function"?this.styleTween(r,ka(r,n,Nt(this,"style."+r,t))).each(Ea(this._id,r)):this.styleTween(r,Ia(r,n,t),e).on("end.style."+r,null)}function Ma(r,t,e){return function(n){this.style.setProperty(r,t.call(this,n),e)}}function Ta(r,t,e){var n,o;function i(){var s=t.apply(this,arguments);return s!==o&&(n=(o=s)&&Ma(r,s,e)),n}return i._value=t,i}function Wo(r,t,e){var n="style."+(r+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;return this.tween(n,Ta(r,t,e==null?"":e))}function Aa(r){return function(){this.textContent=r}}function Da(r){return function(){var t=r(this);this.textContent=t==null?"":t}}function Go(r){return this.tween("text",typeof r=="function"?Da(Nt(this,"text",r)):Aa(r==null?"":r+""))}function za(r){return function(t){this.textContent=r.call(this,t)}}function Na(r){var t,e;function n(){var o=r.apply(this,arguments);return o!==e&&(t=(e=o)&&za(o)),t}return n._value=r,n}function qo(r){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(r==null)return this.tween(t,null);if(typeof r!="function")throw new Error;return this.tween(t,Na(r))}function Ko(){for(var r=this._name,t=this._id,e=tr(),n=this._groups,o=n.length,i=0;i<o;++i)for(var s=n[i],a=s.length,c,l=0;l<a;++l)if(c=s[l]){var h=T(c,t);mt(c,r,e,l,s,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new H(n,this._parents,r,e)}function Zo(){var r,t,e=this,n=e._id,o=e.size();return new Promise(function(i,s){var a={value:s},c={value:function(){--o===0&&i()}};e.each(function(){var l=L(this,n),h=l.on;h!==r&&(t=(r=h).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(c)),l.on=t}),o===0&&i()})}var Pa=0;function H(r,t,e,n){this._groups=r,this._parents=t,this._name=e,this._id=n}function Jo(r){return ht().transition(r)}function tr(){return++Pa}var dt=ht.prototype;H.prototype=Jo.prototype={constructor:H,select:Xo,selectAll:Yo,selectChild:dt.selectChild,selectChildren:dt.selectChildren,filter:Lo,merge:$o,selection:Bo,transition:Ko,call:dt.call,nodes:dt.nodes,node:dt.node,size:dt.size,empty:dt.empty,each:dt.each,on:Fo,attr:Ao,attrTween:Do,style:Uo,styleTween:Wo,text:Go,textTween:qo,remove:Ho,tween:To,delay:zo,duration:No,ease:Po,easeVarying:Ro,end:Zo,[Symbol.iterator]:dt[Symbol.iterator]};function er(r){return((r*=2)<=1?r*r*r:(r-=2)*r*r+2)/2}var Ra={time:null,delay:0,duration:250,ease:er};function La(r,t){for(var e;!(e=r.__transition)||!(e=e[t]);)if(!(r=r.parentNode))throw new Error(`transition ${t} not found`);return e}function Qo(r){var t,e;r instanceof H?(t=r._id,r=r._name):(t=tr(),(e=Ra).time=oe(),r=r==null?null:r+"");for(var n=this._groups,o=n.length,i=0;i<o;++i)for(var s=n[i],a=s.length,c,l=0;l<a;++l)(c=s[l])&&mt(c,r,t,l,s,e||La(c,t));return new H(n,this._parents,r,t)}ht.prototype.interrupt=Mo;ht.prototype.transition=Qo;var{abs:kf,max:Ef,min:Mf}=Math;function ti(r){return[+r[0],+r[1]]}function $a(r){return[ti(r[0]),ti(r[1])]}var Tf={name:"x",handles:["w","e"].map(Yr),input:function(r,t){return r==null?null:[[+r[0],t[0][1]],[+r[1],t[1][1]]]},output:function(r){return r&&[r[0][0],r[1][0]]}},Af={name:"y",handles:["n","s"].map(Yr),input:function(r,t){return r==null?null:[[t[0][0],+r[0]],[t[1][0],+r[1]]]},output:function(r){return r&&[r[0][1],r[1][1]]}},Df={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(Yr),input:function(r){return r==null?null:$a(r)},output:function(r){return r}};function Yr(r){return{type:r}}var ae=r=>()=>r;function Br(r,{sourceEvent:t,target:e,transform:n,dispatch:o}){Object.defineProperties(this,{type:{value:r,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:e,enumerable:!0,configurable:!0},transform:{value:n,enumerable:!0,configurable:!0},_:{value:o}})}function rt(r,t,e){this.k=r,this.x=t,this.y=e}rt.prototype={constructor:rt,scale:function(r){return r===1?this:new rt(this.k*r,this.x,this.y)},translate:function(r,t){return r===0&t===0?this:new rt(this.k,this.x+this.k*r,this.y+this.k*t)},apply:function(r){return[r[0]*this.k+this.x,r[1]*this.k+this.y]},applyX:function(r){return r*this.k+this.x},applyY:function(r){return r*this.k+this.y},invert:function(r){return[(r[0]-this.x)/this.k,(r[1]-this.y)/this.k]},invertX:function(r){return(r-this.x)/this.k},invertY:function(r){return(r-this.y)/this.k},rescaleX:function(r){return r.copy().domain(r.range().map(this.invertX,this).map(r.invert,r))},rescaleY:function(r){return r.copy().domain(r.range().map(this.invertY,this).map(r.invert,r))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var ce=new rt(1,0,0);le.prototype=rt.prototype;function le(r){for(;!r.__zoom;)if(!(r=r.parentNode))return ce;return r.__zoom}function rr(r){r.stopImmediatePropagation()}function Pt(r){r.preventDefault(),r.stopImmediatePropagation()}function Fa(r){return(!r.ctrlKey||r.type==="wheel")&&!r.button}function Ha(){var r=this;return r instanceof SVGElement?(r=r.ownerSVGElement||r,r.hasAttribute("viewBox")?(r=r.viewBox.baseVal,[[r.x,r.y],[r.x+r.width,r.y+r.height]]):[[0,0],[r.width.baseVal.value,r.height.baseVal.value]]):[[0,0],[r.clientWidth,r.clientHeight]]}function ei(){return this.__zoom||ce}function Xa(r){return-r.deltaY*(r.deltaMode===1?.05:r.deltaMode?1:.002)*(r.ctrlKey?10:1)}function Ya(){return navigator.maxTouchPoints||"ontouchstart"in this}function Ba(r,t,e){var n=r.invertX(t[0][0])-e[0][0],o=r.invertX(t[1][0])-e[1][0],i=r.invertY(t[0][1])-e[0][1],s=r.invertY(t[1][1])-e[1][1];return r.translate(o>n?(n+o)/2:Math.min(0,n)||Math.max(0,o),s>i?(i+s)/2:Math.min(0,i)||Math.max(0,s))}function Vr(){var r=Fa,t=Ha,e=Ba,n=Xa,o=Ya,i=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],a=250,c=Hr,l=wt("start","zoom","end"),h,f,u,m=500,O=150,j=0,A=10;function x(d){d.property("__zoom",ei).on("wheel.zoom",P,{passive:!1}).on("mousedown.zoom",U).on("dblclick.zoom",J).filter(o).on("touchstart.zoom",W).on("touchmove.zoom",je).on("touchend.zoom touchcancel.zoom",Ie).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}x.transform=function(d,y,p,b){var _=d.selection?d.selection():d;_.property("__zoom",ei),d!==_?C(d,y,p,b):_.interrupt().each(function(){S(this,arguments).event(b).start().zoom(null,typeof y=="function"?y.apply(this,arguments):y).end()})},x.scaleBy=function(d,y,p,b){x.scaleTo(d,function(){var _=this.__zoom.k,w=typeof y=="function"?y.apply(this,arguments):y;return _*w},p,b)},x.scaleTo=function(d,y,p,b){x.transform(d,function(){var _=t.apply(this,arguments),w=this.__zoom,v=p==null?g(_):typeof p=="function"?p.apply(this,arguments):p,I=w.invert(v),M=typeof y=="function"?y.apply(this,arguments):y;return e(N($(w,M),v,I),_,s)},p,b)},x.translateBy=function(d,y,p,b){x.transform(d,function(){return e(this.__zoom.translate(typeof y=="function"?y.apply(this,arguments):y,typeof p=="function"?p.apply(this,arguments):p),t.apply(this,arguments),s)},null,b)},x.translateTo=function(d,y,p,b,_){x.transform(d,function(){var w=t.apply(this,arguments),v=this.__zoom,I=b==null?g(w):typeof b=="function"?b.apply(this,arguments):b;return e(ce.translate(I[0],I[1]).scale(v.k).translate(typeof y=="function"?-y.apply(this,arguments):-y,typeof p=="function"?-p.apply(this,arguments):-p),w,s)},b,_)};function $(d,y){return y=Math.max(i[0],Math.min(i[1],y)),y===d.k?d:new rt(y,d.x,d.y)}function N(d,y,p){var b=y[0]-p[0]*d.k,_=y[1]-p[1]*d.k;return b===d.x&&_===d.y?d:new rt(d.k,b,_)}function g(d){return[(+d[0][0]+ +d[1][0])/2,(+d[0][1]+ +d[1][1])/2]}function C(d,y,p,b){d.on("start.zoom",function(){S(this,arguments).event(b).start()}).on("interrupt.zoom end.zoom",function(){S(this,arguments).event(b).end()}).tween("zoom",function(){var _=this,w=arguments,v=S(_,w).event(b),I=t.apply(_,w),M=p==null?g(I):typeof p=="function"?p.apply(_,w):p,ot=Math.max(I[1][0]-I[0][0],I[1][1]-I[0][1]),R=_.__zoom,Q=typeof y=="function"?y.apply(_,w):y,at=c(R.invert(M).concat(ot/R.k),Q.invert(M).concat(ot/Q.k));return function(tt){if(tt===1)tt=Q;else{var ct=at(tt),vr=ot/ct[2];tt=new rt(vr,M[0]-ct[0]*vr,M[1]-ct[1]*vr)}v.zoom(null,tt)}})}function S(d,y,p){return!p&&d.__zooming||new k(d,y)}function k(d,y){this.that=d,this.args=y,this.active=0,this.sourceEvent=null,this.extent=t.apply(d,y),this.taps=0}k.prototype={event:function(d){return d&&(this.sourceEvent=d),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(d,y){return this.mouse&&d!=="mouse"&&(this.mouse[1]=y.invert(this.mouse[0])),this.touch0&&d!=="touch"&&(this.touch0[1]=y.invert(this.touch0[0])),this.touch1&&d!=="touch"&&(this.touch1[1]=y.invert(this.touch1[0])),this.that.__zoom=y,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(d){var y=F(this.that).datum();l.call(d,this.that,new Br(d,{sourceEvent:this.sourceEvent,target:x,type:d,transform:this.that.__zoom,dispatch:l}),y)}};function P(d,...y){if(!r.apply(this,arguments))return;var p=S(this,y).event(d),b=this.__zoom,_=Math.max(i[0],Math.min(i[1],b.k*Math.pow(2,n.apply(this,arguments)))),w=G(d);if(p.wheel)(p.mouse[0][0]!==w[0]||p.mouse[0][1]!==w[1])&&(p.mouse[1]=b.invert(p.mouse[0]=w)),clearTimeout(p.wheel);else{if(b.k===_)return;p.mouse=[w,b.invert(w)],yt(this),p.start()}Pt(d),p.wheel=setTimeout(v,O),p.zoom("mouse",e(N($(b,_),p.mouse[0],p.mouse[1]),p.extent,s));function v(){p.wheel=null,p.end()}}function U(d,...y){if(u||!r.apply(this,arguments))return;var p=d.currentTarget,b=S(this,y,!0).event(d),_=F(d.view).on("mousemove.zoom",M,!0).on("mouseup.zoom",ot,!0),w=G(d,p),v=d.clientX,I=d.clientY;Ut(d.view),rr(d),b.mouse=[w,this.__zoom.invert(w)],yt(this),b.start();function M(R){if(Pt(R),!b.moved){var Q=R.clientX-v,at=R.clientY-I;b.moved=Q*Q+at*at>j}b.event(R).zoom("mouse",e(N(b.that.__zoom,b.mouse[0]=G(R,p),b.mouse[1]),b.extent,s))}function ot(R){_.on("mousemove.zoom mouseup.zoom",null),Wt(R.view,b.moved),Pt(R),b.event(R).end()}}function J(d,...y){if(r.apply(this,arguments)){var p=this.__zoom,b=G(d.changedTouches?d.changedTouches[0]:d,this),_=p.invert(b),w=p.k*(d.shiftKey?.5:2),v=e(N($(p,w),b,_),t.apply(this,y),s);Pt(d),a>0?F(this).transition().duration(a).call(C,v,b,d):F(this).call(x.transform,v,b,d)}}function W(d,...y){if(r.apply(this,arguments)){var p=d.touches,b=p.length,_=S(this,y,d.changedTouches.length===b).event(d),w,v,I,M;for(rr(d),v=0;v<b;++v)I=p[v],M=G(I,this),M=[M,this.__zoom.invert(M),I.identifier],_.touch0?!_.touch1&&_.touch0[2]!==M[2]&&(_.touch1=M,_.taps=0):(_.touch0=M,w=!0,_.taps=1+!!h);h&&(h=clearTimeout(h)),w&&(_.taps<2&&(f=M[0],h=setTimeout(function(){h=null},m)),yt(this),_.start())}}function je(d,...y){if(this.__zooming){var p=S(this,y).event(d),b=d.changedTouches,_=b.length,w,v,I,M;for(Pt(d),w=0;w<_;++w)v=b[w],I=G(v,this),p.touch0&&p.touch0[2]===v.identifier?p.touch0[0]=I:p.touch1&&p.touch1[2]===v.identifier&&(p.touch1[0]=I);if(v=p.that.__zoom,p.touch1){var ot=p.touch0[0],R=p.touch0[1],Q=p.touch1[0],at=p.touch1[1],tt=(tt=Q[0]-ot[0])*tt+(tt=Q[1]-ot[1])*tt,ct=(ct=at[0]-R[0])*ct+(ct=at[1]-R[1])*ct;v=$(v,Math.sqrt(tt/ct)),I=[(ot[0]+Q[0])/2,(ot[1]+Q[1])/2],M=[(R[0]+at[0])/2,(R[1]+at[1])/2]}else if(p.touch0)I=p.touch0[0],M=p.touch0[1];else return;p.zoom("touch",e(N(v,I,M),p.extent,s))}}function Ie(d,...y){if(this.__zooming){var p=S(this,y).event(d),b=d.changedTouches,_=b.length,w,v;for(rr(d),u&&clearTimeout(u),u=setTimeout(function(){u=null},m),w=0;w<_;++w)v=b[w],p.touch0&&p.touch0[2]===v.identifier?delete p.touch0:p.touch1&&p.touch1[2]===v.identifier&&delete p.touch1;if(p.touch1&&!p.touch0&&(p.touch0=p.touch1,delete p.touch1),p.touch0)p.touch0[1]=this.__zoom.invert(p.touch0[0]);else if(p.end(),p.taps===2&&(v=G(v,this),Math.hypot(f[0]-v[0],f[1]-v[1])<A)){var I=F(this).on("dblclick.zoom");I&&I.apply(this,arguments)}}}return x.wheelDelta=function(d){return arguments.length?(n=typeof d=="function"?d:ae(+d),x):n},x.filter=function(d){return arguments.length?(r=typeof d=="function"?d:ae(!!d),x):r},x.touchable=function(d){return arguments.length?(o=typeof d=="function"?d:ae(!!d),x):o},x.extent=function(d){return arguments.length?(t=typeof d=="function"?d:ae([[+d[0][0],+d[0][1]],[+d[1][0],+d[1][1]]]),x):t},x.scaleExtent=function(d){return arguments.length?(i[0]=+d[0],i[1]=+d[1],x):[i[0],i[1]]},x.translateExtent=function(d){return arguments.length?(s[0][0]=+d[0][0],s[1][0]=+d[1][0],s[0][1]=+d[0][1],s[1][1]=+d[1][1],x):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},x.constrain=function(d){return arguments.length?(e=d,x):e},x.duration=function(d){return arguments.length?(a=+d,x):a},x.interpolate=function(d){return arguments.length?(c=d,x):c},x.on=function(){var d=l.on.apply(l,arguments);return d===l?x:d},x.clickDistance=function(d){return arguments.length?(j=(d=+d)*d,x):Math.sqrt(j)},x.tapDistance=function(d){return arguments.length?(A=+d,x):A},x}var or=class{constructor(t,e){this.actionLimit=e,this.undoStackList=[],this.redoStackList=[],this.containerInterface=t}addAction(...t){this.undoStackList.length===this.actionLimit&&this.undoStackList.shift(),this.undoStackList.push(t),this.redoStackList.length=0}clear(){this.undoStackList.length=0,this.redoStackList.length=0}popLastUndoAction(){return this.undoStackList.pop()}undo(){let t=this.undoStackList.pop();return t?(t.forEach(e=>e.undo(this.containerInterface)),this.redoStackList.push(t.reverse()),t):null}redo(){let t=this.redoStackList.pop();return t?(t.forEach(e=>e.redo(this.containerInterface)),this.undoStackList.push(t.reverse()),t):null}};var st=class{constructor(t){this.command=t}checkHasId(t){return"id"in t&&(typeof t.id=="number"||typeof t.id=="string")}undo(t){return this}redo(t){return this}};var Z=class extends st{constructor(t){super("add"),this.objDataList=t}undo(t){return this.objDataList.forEach(e=>{this.checkHasId(e)?t.removeObject(e.id):console.error("data has no id",e)}),this}redo(t){return this.objDataList.forEach(e=>t.addRenderObj(e)),this}};var kt=class extends Z{constructor(t){super(t),this.command="delete"}undo(t){return super.redo(t)}redo(t){return super.undo(t)}};var Va=(()=>{let r=null;return function(){if(r||(r=new OffscreenCanvas(0,0).getContext("2d")),!r)throw new Error("Can't create canvas context");return r}})(),he=2,de=10,Ur=(r,t)=>{let e=Va();e.font=`${t.fontSize}px ${t.fontFamily}`;let n=e.measureText(r);return{width:n.width,height:n.fontBoundingBoxAscent+n.fontBoundingBoxDescent}},ue=r=>{let{text:t}=r,e=[],n=[];for(let o of t){if(o==="\r")continue;if(o===`
`){e.push(n.join("")),n.length=0;continue}n.push(o);let i=n.join("");Ur(i,r).width>=r.width&&(e.push(i),n.length=0)}return n.length>0&&e.push(n.join("")),{length:e.length,lineHeight:Ur("|",r).height,lines:e}},ir=r=>{let t=r.text.replace("\r","").split(`
`),e=0,n=0;return t.forEach(o=>{let i=Ur(o,r);n+=r.fontSize+he,e=Math.max(e,i.width)}),{width:e,height:n}},ri=(r,t)=>{let e=ue(r),n=e.lineHeight*e.length;if(t<n){let o=Math.ceil((n-t)/e.lineHeight);e.lines=e.lines.splice(0,e.length-o),e.length=e.lines.length,e.lines[e.length-1]+="..."}return e};var ni="Pretendard",bt={id:"",temp:!1,type:"",render:"",text:"",editable:!0,foreColor:"black",fontSize:16,fontFamily:ni,textDecoration:"none",visibleOverText:!0,opacity:1,cursor:"move",borderColor:"black",borderWidth:1,borderDash:0,isSelected:!1,isMonitoring:!0,isHovered:!1,tooltipText:"",tooltipFontSize:12,tooltipForeColor:"black",tooltipFontFamily:ni,tooltipFill:"white",tooltipMaxWidth:380,tooltipBorderColor:"var(--navy-700)",tooltipBorderWidth:1,tooltipBorderDash:0,tooltipPadding:8,tooltipTextDecoration:"none",tooltipVisible:!0,"borderWidth.selected":2,"borderColor.selected":"blue"};var sr={...bt,"connection.points":[],"connection.sourceObjId":null,"connection.sourcePos":null,"connection.destinationObjId":null,"connection.destinationPos":null,"connection.width":200,"connection.textBorderColor":"black","connection.textBorderWidth":1,"connection.textBorderDash":0,"connection.textBorderFill":"white","connection.connectorFill":"#303030","connection.connectorSize":3,"connection.adjusterSize":7,"connection.adjusterFill":"black","connection.arrowFill":"black","connection.arrowSize":10,"connection.arrowBorderColor":"black","connection.arrowBorderWidth":1,"connection.arrowType":"triangle"};var ar={...bt,"group.margin":20,"group.borderAlwaysAppearance":!1};var cr={...bt,"node.width":120,"node.height":60,"node.fill":"white","node.x":0,"node.y":0,"node.connectorGap":0,"node.connectorSize":5,"node.resizerEnabled":!0,"node.connectorEnabled":!0,"node.commentTopLeft":"","node.commentTopCenter":"","node.commentTopRight":"","node.commentBottomLeft":"","node.commentBottomCenter":"","node.commentBottomRight":"","node.commentFontSize":10,"node.commentForeColor":"black","node.commentFontFamily":"Pretendard","node.borderRadius":0};var Ua=/translate\((-?[\d.]+),\s*?(-?[\d.]+)\)/,Wa=/scale\(([\d.]+),\s*?([\d.]+)\)/,oi={top:0,right:1,bottom:2,left:3},D=45,Ga={node:{...cr},group:{...ar},connection:{...sr}},Gr=(r,t)=>{switch(r.id){case t.sourceObjId:return oi[t.sourcePos];case t.destinationObjId:return oi[t.destinationPos];default:throw new Error("It's not connected.")}},ii=r=>{if(r.indexOf("left")!==-1)return"left";if(r.indexOf("right")!==-1)return"right";if(r.indexOf("top")!==-1)return"top";if(r.indexOf("bottom")!==-1)return"bottom";throw new Error(`Invalid argument '${r}'`)},si=r=>{let t=Ua.exec(r),e=Wa.exec(r),n=0,o=0,i=1;return t&&(n=parseFloat(t[1]),o=parseFloat(t[2])),e&&(i=parseFloat(e[1])),{translateX:n,translateY:o,scale:i}};var nt=(r,t,e)=>{r[t]===void 0&&(r[t]=e)},qa=r=>{switch(nt(r,"cursor","move"),r.temp&&(nt(r,"node.resizerEnabled",!1),nt(r,"node.connectorEnabled",!1)),r.render){case"start":{nt(r,"node.resizerEnabled",!1);break}case"comment":{nt(r,"node.connectorEnabled",!1);break}case"bridge":{nt(r,"editable",20),nt(r,"node.width",20),nt(r,"node.height",20),nt(r,"node.resizerEnabled",!1);break}default:break}},Ka=r=>{nt(r,"cursor","pointer"),(r["connection.points"]===null||r["connection.points"]===void 0)&&(r["connection.points"]=[]);let t=r["connection.points"];for(let e=t.length;e<2;e++)t.push({x:0,y:0})},qr=(r,t)=>Math.sqrt(Math.pow(r.x-t.x,2)+Math.pow(r.y-t.y,2)),Kr=(r,t)=>{let e=Ga[r.type];if(e===void 0)throw new Error(`Unknown type '${r.type}'`);for(let n of Object.keys(e))r[n]===void 0&&(r[n]=t[n]);return r},ai=r=>{switch(r.type){case"node":{qa(r);break}case"connection":{Ka(r);break}case"group":{nt(r,"borderDash.selected",1);break}default:break}},ci=r=>{let t={...r.data},e=r.firstPoint;switch(r.sourcePos){case"top":{r.renderType==="direct"?t["connection.points"]=[e,{x:e.x,y:e.y-D}]:t["connection.points"]=[e,{x:e.x+D,y:e.y-D}];break}case"bottom":{r.renderType==="direct"?t["connection.points"]=[e,{x:e.x,y:e.y+D}]:t["connection.points"]=[e,{x:e.x+D,y:e.y+D}];break}case"left":{r.renderType==="direct"?t["connection.points"]=[e,{x:e.x-D,y:e.y}]:t["connection.points"]=[e,{x:e.x-D,y:e.y+D}];break}case"right":{r.renderType==="direct"?t["connection.points"]=[e,{x:e.x+D,y:e.y}]:t["connection.points"]=[e,{x:e.x+D,y:e.y+D}];break}default:r.renderType==="direct"?t["connection.points"]=[e,{x:e.x+D,y:e.y+D}]:t["connection.points"]=[e,{x:e.x+D/2,y:e.y+D/2},{x:e.x+D,y:e.y+D}];break}return t},xt=r=>{let t=[];return r.forEach(e=>{t.push(jr(e.data))}),t},lr=r=>jr(r),Zr=function*(r){switch(r.type){case"node":yield{key:"node.x",value:r["node.x"]},yield{key:"node.y",value:r["node.y"]};break;case"connection":yield{key:"connection.sourceObjId",value:r["connection.sourceObjId"]},yield{key:"connection.sourcePos",value:r["connection.sourcePos"]},yield{key:"connection.destinationObjId",value:r["connection.destinationObjId"]},yield{key:"connection.destinationPos",value:r["connection.destinationPos"]},yield{key:"connection.points",value:lr(r["connection.points"])};break;case"group":break;default:throw new Error(`Unknow type '${r.type}'`)}};function Jr(r,t,e,n){r.attr("x",t).attr("y",e).attr("fill",n.foreColor).attr("font-family",n.fontFamily).attr("font-size",n.fontSize).attr("text-decoration",n.textDecoration)}function hr(r,t,e,n,o){Jr(r,e,n,o),t.lines.forEach((i,s)=>{let a=r.append("tspan").attr("x",e).attr("dx",0).attr("dy",s===0?0:o.fontSize+he).text(i);i.trim()===""&&a.attr("opacity","0").attr("fill-opacity","0").text(".")})}var li=(r,t)=>{r.selectAll("tspan").remove(),t.clear()},hi=r=>new ke(r);var di=["node.width","node.height"],X=class{constructor(t,e){this._objData=t,this._propList=e||[]}addMoveOldValues(){for(let t of Zr(this._objData))this._propList.push({key:t.key,oldValue:t.value})}addSizeOldValues(){for(let t of di)this._propList.push({key:t,oldValue:this._objData[t],newValue:this._objData[t]})}updateSizeNewValues(){for(let t of di){let e=this._propList.filter(n=>n.key===t)[0];e.newValue=this._objData[t]}}updateMoveNewValues(){for(let t of Zr(this._objData)){let e=this._propList.filter(n=>n.key===t.key)[0];e.newValue=t.value}}get objData(){return this._objData}get propList(){return this._propList}},V=class extends st{constructor(t){super("edit"),this.changeInfoList=t}_setValue(t,e){this.changeInfoList.forEach(n=>{let o=e.getObjectOrNull(n.objData.id);o!==null&&o.editProp(()=>{for(let i of n.propList)o.data[i.key]=i[t]})})}undo(t){return this._setValue("oldValue",t),super.undo(t)}redo(t){return this._setValue("newValue",t),super.redo(t)}};var Lt=class extends st{constructor(t,e,n){super("render"),this.renderObj=t,this.oldRender=e,this.newRender=n}undo(t){return t.changeObjRender(this.renderObj,this.oldRender),super.undo(t)}redo(t){return t.changeObjRender(this.renderObj,this.newRender),super.redo(t)}};var $t=class extends st{constructor(t){super("front"),this.dataList=t}_setZId(t,e,n){let o=l=>{let h=n.getObjectOrNull(l.objId);if(h===null){n.getLogger().error("ZIndexCommand._setZId()",`Could not find obj id '${l.objId}'`);return}h.zIndex=l[t]},[i,s,a]=e?[0,this.dataList.length,1]:[this.dataList.length-1,-1,-1],c=i;for(;i!==s;)o(this.dataList[c]),c+=a}undo(t){return this._setZId("oldValue",!1,t),super.undo(t)}redo(t){return this._setZId("newValue",!0,t),super.redo(t)}};var dr=class{constructor(t,e,n){this.actionController=t,this.objectManager=e,this.iContainer=n,this.movedInfo=[]}moveStartHandler(){this.iContainer.getLogger().debug("MoveHandler.moveStartHandler()","start"),this.movedInfo=[];for(let t of this.objectManager.getSelectedObjIterator()){let e=new X(t.data);e.addMoveOldValues(),this.movedInfo.push(e)}}moveEndHandler(){this.iContainer.getLogger().debug("MoveHandler.moveEndHandler()","end"),this.movedInfo.forEach(t=>t.updateMoveNewValues()),this.movedInfo.some(t=>t.propList.some(e=>Ee(e.oldValue,e.newValue)===!1))&&this.actionController.addAction(new V(this.movedInfo))}};var ur=class{constructor(t,e,n){this.actionController=t,this.objectManager=e,this.iContainer=n,this.resizeInfo=[]}resizeCallback(t,e,n,o){for(let i of this.objectManager.getNodeIterator())if(i.isSelected&&i.id!==t&&i.resizerEnabled){let s=i.height/2,a=i.width/2;switch(e){case"n-resize":i.resizeToNorth(-(s+o));break;case"nw-resize":i.resizeToNorth(-(s+o)),i.resizeToWest(-(a+n));break;case"ne-resize":i.resizeToNorth(-(s+o)),i.resizeToEast(a+n);break;case"w-resize":i.resizeToWest(-(a+n));break;case"e-resize":i.resizeToEast(a+n);break;case"s-resize":i.resizeToSouth(s+o);break;case"sw-resize":i.resizeToSouth(s+o),i.resizeToWest(-(a+n));break;case"se-resize":i.resizeToSouth(s+o),i.resizeToEast(a+n);break;default:throw new Error(`Unknown cursor type '${e}'`)}}for(let i of this.objectManager.getGroupIterator())i.isSelected&&i.render()}resizeDragStart(){this.iContainer.getLogger().debug("ResizeHandler.resizeDragStart()","start"),this.resizeInfo=[];for(let t of this.objectManager.getNodeIterator())if(t.isSelected){let e=new X(t.data);e.addSizeOldValues(),this.resizeInfo.push(e)}}resizeDragEnd(){this.iContainer.getLogger().debug("ResizeHandler.resizeDragEnd()","end"),this.resizeInfo.forEach(t=>t.updateSizeNewValues()),this.resizeInfo.some(t=>t.propList.some(e=>Ee(e.oldValue,e.newValue)===!1))&&this.actionController.addAction(new V(this.resizeInfo))}addDragActionOnResizer(t){t.renderer.resizers.forEach(e=>{let n=e.attr("cursor");e.call(q().filter(()=>this.iContainer.getReadOnly()===!1).on("start",()=>{this.resizeDragStart(),this.iContainer.initDrag("drag-node-resize")}).on("drag",o=>{let i=o.x,s=o.y,a=t.width,c=t.height;switch(n){case"nw-resize":t.resizeToNorth(s),t.resizeToWest(i);break;case"n-resize":t.resizeToNorth(s);break;case"ne-resize":t.resizeToNorth(s),t.resizeToEast(i);break;case"w-resize":t.resizeToWest(i);break;case"e-resize":t.resizeToEast(i);break;case"sw-resize":t.resizeToSouth(s),t.resizeToWest(i);break;case"s-resize":t.resizeToSouth(s);break;case"se-resize":t.resizeToSouth(s),t.resizeToEast(i);break;default:throw new Error(`Unknown cursor type '${n}'`)}let l=t.width-a,h=t.height-c;this.resizeCallback(t.id,n,l,h)}).on("end",()=>{this.resizeDragEnd(),this.iContainer.terminateDrag("drag-node-resize")}))})}};var z={CLICK:"click",CLICK_NODE:"clickNode",DOUBLE_CLICK_NODE:"dblClickNode",CLICK_CONNECTION:"clickConnection",DOUBLE_CLICK_CONNECTION:"dblClickConnection",NEW_OBJECT:"newObject",REMOVE_OBJECT:"removeObject",SELECT_OBJECT:"selectObject",RELEASE_OBJECT:"releaseObject",UNDO:"undo",REDO:"redo",COMMAND:"command",CHANGE_CLASS:"changeClass",DISCONNECT_NODE:"disconnectNode",CONNECT_NODE:"connectNode",MOUSEUP_SHEET:"mouseUpSheet",CONTEXT_MENU:"contextmenu"};var fr=class{constructor(t,e,n,o){this.renderObj=t,this.key=e,this.newValue=n,this.oldValue=o}};var _t=class{constructor(t,e,n){this._clickedSeq=0;this.data=t,this.renderer=e,this.containerInterface=n}get onEditing(){return this.renderer.objects.foreignObj!==null}get clickedSeq(){return this._clickedSeq}get tooltipText(){return this.getDataOrNull("tooltipText")}get g(){return this.renderer.group}get isSelected(){return this.data.isSelected}get type(){return this.data.type}get renderType(){return this.data.render}get tooltipVisible(){return this.getDataOrNull("tooltip.visible")}get canShowTooltip(){return this.getDataOrNull("tooltipText")&&this.getDataOrNull("tooltipVisible")}get id(){return this.data.id}get startX(){throw new Error("Not Implemented!")}get startY(){throw new Error("Not Implemented!")}get isTempObj(){return this.data.temp||!1}get zIndex(){let t=this.renderer.group.node();if(!t)throw new Error("renderer.group.node is null!");let e=0,n=t.previousSibling;for(;n!==null;)n=n.previousSibling,++e;return e}get centerX(){return(this.x+this.endX)/2}get centerY(){return(this.y+this.endY)/2}get x(){throw new Error("Not Implemented!")}get y(){throw new Error("Not Implemented!")}get endX(){throw new Error("Not Implemented!")}get endY(){throw new Error("Not Implemented!")}get width(){throw new Error("Not Implemented!")}get height(){throw new Error("Not Implemented!")}get textDecoration(){return this.getDataOrNull("textDecoration")}get isHovered(){return this.data.isHovered}set id(t){this.data.id=t}set x(t){throw new Error("Not Implemented!")}set y(t){throw new Error("Not Implemented!")}set width(t){throw new Error("Not Implemented!")}set height(t){throw new Error("Not Implemented!")}set textDecoration(t){this.data.textDecoration=t}set isHovered(t){this.data.isHovered=t}set clickedSeq(t){this._clickedSeq=t}set zIndex(t){let e=this.renderer.container.node(),n=this.renderer.group.node();if(!e||!n)throw new Error("container or graphic element is null");t==null||t>=e.children.length?e.appendChild(n):e.insertBefore(n,e.children[t])}observeProperties(){Object.keys(this.data).forEach(t=>{let e=this.data[t];Object.defineProperty(this.data,t,{enumerable:!0,get:()=>e,set:n=>{let o=e;e=n,this.data.isMonitoring&&(this.containerInterface.observerCallback(new fr(this,t,n,o)),this.render())}})})}changeRender(t,e){this.data.render=t,this.destroy(),this.renderer=e,this.create()}create(){this.renderer.create(),this.observeProperties()}destroy(){this.renderer.destroy()}render(){this.renderer.render(),this.containerInterface.renderCallback(this)}moveTo(t,e){this.editProp(()=>{this.x+=t,this.y+=e})}select(t=!1,e=""){this.data.isSelected===!1&&(this.data.isSelected=!0,this.containerInterface.selectCallback(this,t,e))}release(t=!1){this.data.isSelected&&(this.data.isSelected=!1,this.containerInterface.releaseCallback(this,t))}editLabel(){this.renderer.editLabelMode()}getDataOrNull(t){return this.renderer.dataWrapper.get(t)||null}editProp(t){try{this.data.isMonitoring=!1,t()}finally{this.data.isMonitoring=!0}}};var Qr=class extends _t{get points(){return this.data["connection.points"]}get endX(){return this.points.reduce((t,e)=>Math.max(t,e.x),0)}get endY(){return this.points.reduce((t,e)=>Math.max(t,e.y),0)}get sourceObjId(){return this.data["connection.sourceObjId"]||null}get sourceObj(){return this.containerInterface.getObjectOrNull(this.data["connection.sourceObjId"])}get destinationObj(){return this.containerInterface.getObjectOrNull(this.data["connection.destinationObjId"])}get destinationObjId(){return this.data["connection.destinationObjId"]||null}get sourcePos(){return this.data["connection.sourcePos"]||null}get destinationPos(){return this.data["connection.destinationPos"]||null}get firstPoint(){return this.points[0]}get endPoint(){return this.points[this.points.length-1]}get startX(){return this.points.reduce((t,e)=>Math.min(t,e.x),Number.MAX_VALUE)}get startY(){return this.points.reduce((t,e)=>Math.min(t,e.y),Number.MAX_VALUE)}get width(){if(!this.points)return NaN;let t=this.points.reduce((e,n)=>({min:Math.min(e.min,n.x),max:Math.max(e.max,n.x)}),{min:Number.MAX_VALUE,max:Number.MIN_VALUE});return t.max-t.min}get height(){if(!this.points)return NaN;let t=this.points.reduce((e,n)=>({min:Math.min(e.min,n.y),max:Math.max(e.max,n.y)}),{min:Number.MAX_VALUE,max:Number.MIN_VALUE});return t.max-t.min}get x(){let t=this.firstPoint;return t!==null?t.x:null}get y(){let t=this.firstPoint;return t!==null?t.y:null}set sourceObjId(t){this.data["connection.sourceObjId"]=t||null}set destinationObjId(t){this.data["connection.destinationObjId"]=t||null}set sourcePos(t){this.data["connection.sourcePos"]=t||null}set destinationPos(t){this.data["connection.destinationPos"]=t||null}set x(t){if(this.sourceObjId!==null)return;let e=this.firstPoint;e!==null&&(e.x=t,this.render())}set y(t){if(this.sourceObjId!==null)return;let e=this.firstPoint;e!==null&&(e.y=t,this.render())}setLastPointXY(t,e){this.data["connection.points"][this.renderer.lastPointId].x=t,this.data["connection.points"][this.renderer.lastPointId].y=e,this.render()}moveTo(t,e){if(this.sourceObj&&this.destinationObj)return;let n=this.sourceObj===null?0:1,o=this.points.length-(this.destinationObj===null?0:1);this.editProp(()=>{this.points.slice(n,o).forEach(i=>{i.x+=t,i.y+=e})})}comparePoints(t){if(!this.points||!t||this.points.length!==t.length)return!1;for(let e=0;e<t.length;e++)if(this.points[e].x!==t[e].x&&this.points[e].y!==t[e].y)return!1;return!0}},ui=Qr;var tn=class extends _t{constructor(t,e,n){super(t,e,n),this.objectSet=new Set(this.data.objectList||[]),this.rect={x:0,y:0,width:0,height:0}}get startX(){return this.x}get startY(){return this.y}get x(){return this.rect.x}get y(){return this.rect.y}get width(){return this.rect.width}get height(){return this.rect.height}get endX(){return this.x+this.width}get endY(){return this.y+this.height}select(t,e=""){this.objectSet.forEach(n=>{let o=this.containerInterface.getObjectOrNull(n);o!=null&&(e==""||e!=""&&e==o.renderType)&&(o.data.isSelected=!0)}),super.select(t)}release(t=!1){this.objectSet.forEach(e=>{let n=this.containerInterface.getObjectOrNull(e);n!=null&&n.release(t)}),super.release(t)}resize(){let t=this.data["group.margin"],e=Number.MAX_VALUE,n=Number.MAX_VALUE,o=Number.MIN_VALUE,i=Number.MIN_VALUE;this.objectSet.forEach(s=>{let a=this.containerInterface.getObjectOrNull(s);a!==null&&(e=Math.min(a.startX-t,e),o=Math.max(a.endX+t,o),n=Math.min(a.startY-t,n),i=Math.max(a.endY+t,i))}),this.data["group.rect"]=this.rect,this.rect.x=e,this.rect.y=n,this.rect.width=o-e,this.rect.height=i-n}moveTo(){this.render()}hasObjId(t){return this.objectSet.has(t)}destroy(){this.objectSet.clear(),super.destroy()}destroyAll(){this.objectSet.forEach(t=>{let e=this.containerInterface.getObjectOrNull(t);e!=null&&this.containerInterface.removeObject(e)}),this.destroy()}clear(){this.objectSet.clear()}addObject(t){if(this.objectSet.has(t)===!1)this.objectSet.add(t),this.resize();else throw new Error(`Already has added id! '${t}'`)}removeObject(t){if(this.objectSet.has(t))this.objectSet.delete(t),this.resize();else throw new Error(`There is no id you received in this group!'${t}'`)}},fi=tn;var Za=new Set(["id","type","render","text","editable","isSelected","isMonitoring","isHovered","node.width","node.height","node.x","node.y","node.connectorEnabled","node.resizerEnabled","connection.points","connection.sourceObjId","connection.sourcePos","connection.destinationObjId","connection.destinationPos","group.borderAlwaysAppearance","group.margin"]),fe=class{constructor(t){this.data=t}get(t){var e;return Za.has(t)?this.data[t]:(e=this.data[`${t}${this._getPostFix()}`])!=null?e:this.data[t]}_getPostFix(){return this.data.isSelected?".selected":this.data.isHovered?".hovered":""}};var en=class{constructor(){this.text="";this.length=0;this.width=0;this.height=0;this.x=0;this.y=0}},Et=class extends en{compareTo(t){return this.text===t.text&&this.length===t.length&&this.width===t.width&&this.height===t.height&&this.x===t.x&&this.y===t.y}update(t){this.text=t.text,this.length=t.length,this.width=t.width,this.height=t.height,this.x=t.x,this.y=t.y}clear(){this.text="",this.length=0,this.width=0,this.height=0,this.x=0,this.y=0}};var ut=class{constructor(t,e,n){this.data=t,this.className=e,this.containerInterface=n,this.textCache=new Et,this.dataWrapper=new fe(t),this.container=n.getSvg().select(".container"),this.group=this.container.append("g").attr("class",`${t.type} ${e}`),this.objects={foreignObj:null,textarea:null,text:this.group.append("text").attr("class","unselectable text--whitespace-pre").attr("text-anchor","middle")}}get width(){throw new Error("Not implemented!")}get height(){throw new Error("Not implemented!")}get subUiVisibility(){return this.data.isSelected&&this.containerInterface.getReadOnly()===!1?"visible":"hidden"}get isHovered(){return this.data.isHovered}_getLabelRect(){return{x:0,y:0,width:0,height:0}}_repositionTextarea(){if(!this.objects.foreignObj||!this.objects.textarea)throw new Error("foreignObj, textarea is null!");let t=this._getLabelRect();this.objects.foreignObj.attr("x",t.x).attr("y",t.y).attr("width",t.width).attr("height",t.height),this.objects.textarea.style("width",`${t.width}px`).style("height",`${t.height}px`).style("outline","1px solid #717171").style("background-color","transparent")}removeLabelEdit(){this.objects.foreignObj&&(this.objects.text.attr("visibility","visible"),this.objects.textarea=null,this.objects.foreignObj.remove(),this.objects.foreignObj=null,this.containerInterface.setEditMode(!1))}cancelLabelEdit(t){this.removeLabelEdit(),this.data.text=t}editLabelMode(){if(!this.data.editable||this.objects.foreignObj||this.data.render==="bridge")return;let t=this.data.text;this.group.classed("edit",!0),this.containerInterface.setEditMode(!0),this.objects.text.attr("visibility","hidden"),this.objects.foreignObj=this.group.append("foreignObject"),this.objects.textarea=this.objects.foreignObj.append("xhtml:div").style("overflow","hidden").append("textarea").style("outline","0").style("resize","none").style("text-align","center").style("font-family",this.data.fontFamily).style("font-size",`${this.data.fontSize}px`).on("keyup",e=>{e.key==="Escape"?(this.cancelLabelEdit(t),this.containerInterface.getSvg().node().parentElement.focus()):(this.data.text=this.objects.textarea.node().value,this._repositionTextarea())}).on("focusout",()=>{this.objects.textarea&&(this.data.text=this.objects.textarea.node().value,this.containerInterface.editTextCallback(this.data,t,this.data.text),this.removeLabelEdit()),this.group.classed("edit",!1),this.render()}),this._repositionTextarea(),this.objects.textarea.node().value=this.data.text||"",this.objects.textarea.node().focus(),this.containerInterface.editTextModeCallback(this.data)}bringToFrontElement(t){this.group.node().appendChild(t)}create(){this._create(),this.bringToFrontElement(this.objects.text.node()),this.render()}_create(){throw new Error("Not implemented method!")}render(){this._render(),this.group.attr("cursor",this.dataWrapper.get("cursor")),this.group.attr("opacity",this.dataWrapper.get("opacity"))}_render(){throw new Error("Not implemented method!")}_getLabelXY(t){throw new Error("Not implemented!")}_createText(t=0,e=0){let n={width:this.width-de,text:this.dataWrapper.get("text"),fontFamily:this.dataWrapper.get("fontFamily"),fontSize:this.dataWrapper.get("fontSize"),foreColor:this.dataWrapper.get("foreColor"),textDecoration:this.dataWrapper.get("textDecoration")},i=this.dataWrapper.get("visibleOverText")?ue(n):ri(n,this.height-de),s=this._getLabelXY(i),a={text:n.text,width:this.width,height:this.height,length:i.lines.length,x:s.x,y:s.y,fontFamily:n.fontFamily,fontSize:n.fontSize,foreColor:n.foreColor,textDecoration:n.textDecoration};if(this.textCache.compareTo(a)){Jr(this.objects.text,s.x+t,s.y+e,n);return}li(this.objects.text,this.textCache),hr(this.objects.text,i,s.x+t,s.y+e,n),this.textCache.update(a)}destroy(){this.group.remove()}};var Ft=6,pi=5,gi=[["TopLeft","start"],["TopCenter","middle"],["TopRight","end"],["BottomLeft","start"],["BottomCenter","middle"],["BottomRight","end"]],Y=class extends ut{constructor(t,e,n){super(t,e,n),this.svg=this.containerInterface.getSvg(),this.connectors=[],this.resizers=[],this.comments=[],this.backgroundRect=this.group.append("rect").attr("opacity","0")}get width(){return this.data["node.width"]}get height(){return this.data["node.height"]}get connectorVisibility(){return this.data["node.connectorEnabled"]&&this.containerInterface.isAppending()}get resizerVisibility(){return this.data["node.resizerEnabled"]===!0&&this.data.isSelected}_createComments(){gi.forEach(t=>{let[e,n]=t;this.comments.push(this.group.append("text").attr("class",`${e} unselectable`).attr("text-anchor",n))})}_createResizer(){let t=this.group;for(let e of this.getResizerPosition()){let n=t.append("rect").attr("x",e[0]-Ft/2).attr("y",e[1]-Ft/2).attr("width",Ft).attr("height",Ft).attr("fill","rgb(173, 216, 230)").attr("stroke","rgb(30, 144, 255)").attr("cursor",e[2]).attr("class","resizer").attr("visibility","hidden");this.resizers.push(n)}}_createConnector(){let t=this.group;for(let e of this.getConnectorPosition()){let n=t.append("circle").attr("cx",e.x).attr("cy",e.y).attr("r",this.dataWrapper.get("node.connectorSize")).attr("class",`connector ${e.dir}`);this.connectors.push(n)}}_renderComments(){let t=this.dataWrapper,e=t.get("node.commentFontFamily"),n=t.get("node.commentFontSize"),o=this.width/2,i=this.height/2,s=-(i+pi),a=i+pi+n,c={TopLeft:{x:-o,y:s},TopCenter:{x:0,y:s},TopRight:{x:o,y:s},BottomLeft:{x:-o,y:a},BottomCenter:{x:0,y:a},BottomRight:{x:o,y:a}};gi.forEach((l,h)=>{let f=c[l[0]];this.comments[h].attr("x",f.x).attr("y",f.y).attr("font-family",e).attr("font-size",n).text(()=>this.dataWrapper.get(`node.comment${l[0]}`))})}_renderConnector(){let t=0;for(let e of this.getConnectorPosition())this.isHovered&&this.connectorVisibility&&this.containerInterface.getReadOnly()===!1?(this.bringToFrontElement(this.connectors[t].node()),this.connectors[t++].attr("cx",e.x).attr("cy",e.y).attr("visibility","visible").attr("r",this.dataWrapper.get("node.connectorSize")).classed("active",!0)):this.connectors[t++].classed("active",!1).attr("visibility",this.connectorVisibility&&this.containerInterface.getReadOnly()===!1?"visible":"hidden")}_renderResizer(){if(this.resizers.length===0)return;let t=0;for(let e of this.getResizerPosition())this.isHovered&&this.resizerVisibility&&this.containerInterface.getReadOnly()===!1?(this.bringToFrontElement(this.resizers[t].node()),this.resizers[t++].attr("x",e[0]-Ft/2).attr("y",e[1]-Ft/2).attr("class","resizer").attr("visibility","visible").classed("active",!0)):this.resizers[t++].classed("active",!1).attr("visibility",this.resizerVisibility&&this.containerInterface.getReadOnly()===!1?"visible":"hidden")}*getConnectorPosition(){let t=this.dataWrapper.get("node.connectorGap"),e=this.width/2,n=this.height/2;yield{x:-(t+e),y:0,dir:"left"},yield{x:e+t,y:0,dir:"right"},yield{x:0,y:-(t+n),dir:"top"},yield{x:0,y:t+n,dir:"bottom"}}*getResizerPosition(){let t=this.width/2,e=this.height/2;yield[-t,-e,"nw-resize"],yield[0,-e,"n-resize"],yield[t,-e,"ne-resize"],yield[-t,0,"w-resize"],yield[t,0,"e-resize"],yield[-t,e,"sw-resize"],yield[0,e,"s-resize"],yield[t,e,"se-resize"]}_create(){this._createComments(),this._createResizer(),this._createConnector()}_getLabelXY(t){let e=this.dataWrapper.get("fontSize");return{x:0,y:e-(e+he)*t.length/2}}_getLabelRect(){let t=this.width,e=this.height;return{x:-(t/2),y:-(e/2),width:t,height:e}}_resizerVisibleBackgroundRect(){this.backgroundRect.attr("x",-(this.width/2)).attr("y",-(this.height/2)).attr("width",this.width).attr("height",this.height).style("fill","white")}render(){let t=this.data["node.x"]+this.data["node.width"]/2,e=this.data["node.y"]+this.data["node.height"]/2;this.group.attr("transform",`translate(${t}, ${e})`),this.resizerVisibility?this._resizerVisibleBackgroundRect():this.backgroundRect.style("fill","none"),super.render(),this._renderComments(),this._renderResizer(),this._renderConnector()}};var mi=5,pr=30,gr=30,Ja=new Set(["TopLeft","TopCenter","TopRight","BottomLeft","BottomCenter","BottomRight"]),rn=class extends _t{constructor(t,e,n){super(t,e,n),this.renderer=e}get startX(){return this.x}get startY(){let e=this.data["node.commentTopLeft"]||this.data["node.commentTopCenter"]||this.data["node.commentTopRight"]?mi+this.data["node.commentFontSize"]:0;return this.y-e}get resizerEnabled(){return this.data["node.resizerEnabled"]===!0}get isConnectorEnabled(){return this.data["node.connectorEnabled"]===!0}get centerX(){return this.x+this.width/2}get centerY(){return this.y+this.height/2}get x(){return this.data["node.x"]}get y(){return this.data["node.y"]}get width(){return this.data["node.width"]}get height(){return this.data["node.height"]}get endX(){return this.x+this.width}get endY(){let e=this.data["node.commentBottomLeft"]||this.data["node.commentBottomCenter"]||this.data["node.commentBottomRight"]?mi+this.data["node.commentFontSize"]:0;return this.y+this.height+e}set x(t){this.data["node.x"]=t}set y(t){this.data["node.y"]=t}set width(t){this.data["node.width"]=t}set height(t){this.data["node.height"]=t}create(){super.create()}getPositionXY(t){switch(t){case"left":return{x:this.x,y:this.y+this.height/2};case"right":return{x:this.x+this.width,y:this.y+this.height/2};case"top":return{x:this.x+this.width/2,y:this.y};case"bottom":return{x:this.x+this.width/2,y:this.y+this.height};default:throw new Error(`Invalid argument '${t}'`)}}fitSizeOnText(){let t=ir(this.data),e=de*2;this.width=t.width+e,this.height=t.height+e}resizeToNorth(t){let e=-(this.height/2),n=parseInt(e-t);this.height+n>=gr?(this.y-=n,this.height=this.height+n):(this.y+=this.height-gr,this.height=gr)}resizeToWest(t){let e=-(this.width/2),n=parseInt(e-t);this.width+n>=pr?(this.x-=n,this.width=this.width+n):(this.x+=this.width-pr,this.width=pr)}addComment(t,e,n){if(!Ja.has(e))throw new Error(`Unknown position value '${e}' Please call with 'TopLeft' or 'TopCenter' or 'TopRight' or 'BottomLeft' or 'BottomCenter' or 'BottomRight'`);let o=`node.comment${e}`;n&&(o+=`.${n}`),this.data[o]=t}resizeToEast(t){this.width=Math.max(pr,parseInt(t+this.width/2))}resizeToSouth(t){this.height=Math.max(gr,parseInt(t+this.height/2))}},yi=rn;var Qa='{"objects": []}',bi={},mr={saveData(r){hn(bi,r)},loadData(){var r;return(r=dn(bi))!=null?r:Qa}};var yr=class{constructor(t){Object.assign(this,t)}};var tc=new ke("Flowchart::ObjectManager"),nn=class{constructor(){this.objMap={node:new Map,connection:new Map,group:new Map}}getMap(t){let e=this.objMap[t];if(e===void 0)throw tc.error("ObjectManager.getMap()",`Unknown '${t}' type`),new Error(`Unknown '${t}' type`);return e}getObjCount(){return this.objMap.node.size+this.objMap.connection.size+this.objMap.group.size}add(t){let e=this.getMap(t.type);if(e.has(t.id))throw new Error(`Already has objId '${t.id}'`);e.set(t.id,t)}remove(t){let e=this.getMap(t.type);e.has(t.id)&&e.delete(t.id)}*getMapIterator(){yield*Object.values(this.objMap)}getNodeIterator(){return this.objMap.node.values()}getConnectionIterator(){return this.objMap.connection.values()}getGroupIterator(){return this.objMap.group.values()}findOrNull(t){for(let e of this.getMapIterator())if(e.has(t))return e.get(t);return null}clear(){Object.values(this.objMap).forEach(t=>t.clear())}*getAllObjIterator(){for(let t of Object.values(this.objMap))yield*t.values()}*getSelectedObjIterator(){for(let t of this.getAllObjIterator())t.isSelected&&(yield t)}getParentGroupOrNull(t){for(let e of this.getGroupIterator())if(e.hasObjId(t.id))return e;return null}*getConnectedConnections(t){for(let e of this.getConnectionIterator())!e.isTempObj&&(e.sourceObjId===t||e.destinationObjId===t)&&(yield e)}reassignId(t,e,n){let o=this.getMap(t.type);o.delete(e),o.set(n,t)}},xi=nn;var ec=10,rc=10,nc=500,oc=200,pe=class{constructor(t){this.tmpOut=!1;this.containerInterface=t,this.tooltip={objId:null,mouseOverTimer:null,mouseOutTimer:null,g:null,textCache:new Et},this.isFirefox=window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}commonOverOutAction(t){let e=0,n=0;t.g.on("mousemove",o=>{e=o.offsetX+ec,n=o.offsetY+rc}).on("mouseover",()=>{t.isHovered=!0,this.containerInterface.getSelectNodeOnHover()&&t.type==="node"&&!this.containerInterface.isDragging()&&(this.containerInterface.releaseAllObjects(),t.select(!0)),!(this.containerInterface.getTooltipHidden()||!t.canShowTooltip)&&(this.tooltip.mouseOutTimer!=null&&this.tooltip.mouseOutTimer.stop(),this.tooltip.mouseOverTimer=It(()=>{t.isHovered&&t.onEditing===!1&&t.id!==this.tooltip.objId&&!this.containerInterface.getTooltipHidden()&&this.createTooltipObj(t.data,e,n)},nc))}).on("mouseout",()=>{t.isHovered=!1,!(this.containerInterface.getTooltipHidden()||!t.canShowTooltip)&&(this.tooltip.mouseOverTimer!=null&&this.tooltip.mouseOverTimer.stop(),this.tooltip.mouseOutTimer=It(()=>{t.isHovered||this.removeTooltipObj()},oc))})}createTooltipObj(t,e,n){this.removeTooltipObj(),this.tooltip.objId=t.id,this.tooltip.g=this.containerInterface.getSvg().append("g").attr("class","tooltip");let o=this.containerInterface.getObjectOrNull(this.tooltip.objId);if(o===null)return;let i={text:o.getDataOrNull("tooltipText"),foreColor:o.getDataOrNull("tooltipForeColor"),fontFamily:o.getDataOrNull("tooltipFontFamily"),fontSize:o.getDataOrNull("tooltipFontSize"),textDecoration:o.getDataOrNull("tooltipTextDecoration"),padding:o.getDataOrNull("tooltipPadding"),fill:o.getDataOrNull("tooltipFill"),borderColor:o.getDataOrNull("tooltipBorderColor"),borderWidth:o.getDataOrNull("tooltipBorderWidth"),borderDash:o.getDataOrNull("tooltipBorderDash"),width:0},s=ir(i);i.width=Math.min(s.width,o.data.tooltipMaxWidth);let a=ue(i);this.tooltip.g.append("rect").attr("x",e).attr("y",n).attr("rx","4").attr("width",i.width+i.padding*2).attr("height",a.lineHeight*a.length+i.padding*2).attr("fill",i.fill).attr("stroke",i.borderColor).attr("stroke-width",i.borderWidth).attr("stroke-dasharray",i.borderDash);let c=this.tooltip.g.append("text").attr("fill",i.foreColor).attr("fontSize",i.fontSize).attr("text-decoration",i.textDecoration);hr(c,a,e+i.padding,n+i.padding+i.fontSize,i)}removeTooltipObj(){this.tooltip.g!==null&&(this.tooltip.g.remove(),this.tooltip.objId=null,this.tooltip.g=null,this.tooltip.textCache.clear())}addMouseAction(t){this.commonOverOutAction(t)}};var Ht=class{constructor(t,e,n,o){this.startX=t,this.startY=e,this.endX=n,this.endY=o}isContained(t,e){return t>=this.startX&&t<=this.endX&&e>=this.startY&&e<=this.endY}};var ge=class extends Y{constructor(t,e){super(t,"bridge",e)}_create(){this.objects.body=this.group.append("rect"),super._create()}_render(){let t=this.dataWrapper,e=this.width,n=this.height;this.objects.body.attr("x",-(e/2)).attr("y",-(n/2)).attr("rx",(e+n)/6).style("width",`${e}px`).style("height",`${n}px`).style("fill",t.get("node.fill")).style("stroke-width",t.get("borderWidth")).attr("stroke",t.get("borderColor")).attr("stroke-dasharray",t.get("borderDash"))}};var Xt=15,ic=-4,sc=2,me=class extends Y{constructor(t,e){super(t,"comment",e)}_create(){this.objects.body=this.group.append("path").attr("class","body").classed(this.data.type,!0),super._create()}_getPath(){let t=[],e=this.width/2,n=this.height/2,o=-e,i=-n;return t.push(`M${o} ${i}`),t.push(`L${e-Xt} ${i}`),t.push(`L${e},${i+Xt}`),t.push(`L${e},${n}`),t.push(`L${o},${n}`),t.push("Z"),t.push(`M${e-Xt} ${i}`),t.push(`L${e-(Xt+ic)} ${i+(Xt+sc)}`),t.push(`L${e} ${i+Xt}`),t.join(" ")}_render(){let t=this.dataWrapper;this.objects.body.attr("d",this._getPath()).style("fill",t.get("node.fill")).style("stroke-width",t.get("borderWidth")).attr("stroke",t.get("borderColor")).attr("stroke-dasharray",t.get("borderDash")),this._createText()}};var _i=.28,ye=class extends Y{constructor(t,e){super(t,"db",e)}_create(){this.objects.circle=this.group.append("ellipse"),this.objects.body=this.group.append("path"),super._create()}get circleHeight(){return this.height*_i}_getPath(){let t=[],e=this.height/2,n=this.circleHeight/2,o=this.width/2,i=-o,s=o,a=-e+n,c=e-n;return t.push(`M${i} ${a}`),t.push(`A${o} ${n} 0 0 0 ${s} ${a}`),t.push(`V${c}`),t.push(`A${o} ${n} 0 0 1 ${i} ${c}`),t.push(`V${a}`),t.join(" ")}_render(){let t=this.dataWrapper,e=this.circleHeight/2,n=this.width/2,i=-(this.height/2)+e,s={fill:t.get("node.fill"),borderWidth:t.get("borderWidth"),borderColor:t.get("borderColor"),borderDash:t.get("borderDash")};this.objects.circle.attr("cx",0).attr("cy",i).attr("rx",n).attr("ry",e).style("fill",s.fill).style("stroke-width",s.borderWidth).attr("stroke",s.borderColor).attr("stroke-dasharray",s.borderDash),this.objects.body.attr("d",this._getPath()).style("fill",s.fill).style("stroke-width",s.borderWidth).attr("stroke",s.borderColor).attr("stroke-dasharray",s.borderDash);let a=this.height*_i;this._createText(0,a/2)}};var Mt=class extends ut{constructor(t,e,n){super(t,e,n),this.markerId=`${this.containerInterface.getUUID()}_marker_${this.data.id}`,this.objects.marker=this.group.append("svg:defs").append("svg:marker").attr("id",this.markerId),this.objects.markerPath=this.objects.marker.append("path"),this.checkChanged={points:null,srcX:0,srcY:0,desX:0,desY:0}}get width(){return this.data["connection.width"]}get height(){return 0}get lastPointId(){return this.data["connection.points"].length-1}create(){super.create(),this.bringToFrontElement(this.objects.sourceConnector.node()),this.bringToFrontElement(this.objects.destinationConnector.node())}_createConnector(){this.objects.sourceConnector=this.group.append("circle").attr("cursor","crosshair"),this.objects.destinationConnector=this.group.append("circle").attr("cursor","crosshair")}_getPosLocation(t,e){let n=0,o=0;switch(e){case"left":n=-(t.width/2);break;case"right":n=t.width/2;break;case"top":o=-(t.height/2);break;case"bottom":o=t.height/2;break;default:throw new Error(`Invalid argument '${e}'`)}return{x:n,y:o}}_getBBox(){return this.objects.text.node().getBBox()}_getLabelRect(){let t=this._getBBox(),e=t.width+10,n=t.height+10;return{x:parseFloat(this.objects.text.attr("x"))-e/2,y:parseFloat(this.objects.text.attr("y"))-5-this.data.fontSize,width:e,height:Math.max(n,this.data.fontSize+10)}}_renderMarker(){let t=this.dataWrapper,e=t.get("borderWidth"),n=t.get("connection.arrowSize"),o=t.get("connection.arrowFill"),i=t.get("connection.arrowBorderColor"),s=t.get("connection.arrowBorderWidth"),a=(n+s)/e,c=s/e;this.objects.markerPath.attr("fill",o).attr("stroke",i).attr("stroke-width",c);let l=t.get("connection.arrowType");switch(this.objects.marker.attr("refY",a/2).attr("markerWidth",a).attr("markerHeight",a).attr("orient","auto"),l){case"triangle":this._renderTriangleMarker(a,c);break;case"circle":this._renderCircleMarker(a,c);break;default:throw new Error(`unknown render type '${l}'`)}}_renderTriangleMarker(t,e){let n=t-e;this.objects.marker.attr("refX",t),this.objects.markerPath.attr("d",`M ${e} ${e} L ${n} ${t/2} L ${e} ${n} z`)}_renderCircleMarker(t,e){let n=t/2,o=(t-e)/2;this.objects.marker.attr("refX",n),this.objects.markerPath.attr("d",`M ${n} ${n} m ${o} 0 a ${o} ${o} 0 1 0 -${o*2} 0 a ${o} ${o} 0 1 0 ${o*2} 0`)}_renderConnector(){let t=this.dataWrapper,e=this._getSourceLoc(),n=this._getDestinationLoc(),o={size:t.get("connection.connectorSize"),fill:t.get("connection.connectorFill")};this.objects.sourceConnector.attr("cx",e.x).attr("cy",e.y).attr("r",o.size).attr("fill",o.fill).attr("visibility",this.subUiVisibility),this.objects.destinationConnector.attr("cx",n.x).attr("cy",n.y).attr("r",o.size).attr("fill",o.fill).attr("visibility",this.subUiVisibility)}_getSourceLoc(){return this._getNodePositionLoc(this.data["connection.sourceObjId"],this.data["connection.sourcePos"],0)}_getDestinationLoc(){return this._getNodePositionLoc(this.data["connection.destinationObjId"],this.data["connection.destinationPos"],this.lastPointId)}_recordLastInfo(t,e){this.checkChanged.points=this.data["connection.points"],this.checkChanged.srcX=t.x,this.checkChanged.srcY=t.y,this.checkChanged.desX=e.x,this.checkChanged.desY=e.y}_updatePoints(...t){this.data["connection.points"]===void 0||this.data["connection.points"]===null?this.data["connection.points"]=[]:this.data["connection.points"].splice(0,this.data["connection.points"].length),t.forEach(e=>this.data["connection.points"].push(e))}_isChanged(t,e){try{let n=this.checkChanged.srcX-this.checkChanged.desX,o=t.x-e.x,i=this.checkChanged.srcY-this.checkChanged.desY,s=t.y-e.y;return n!==o||i!==s}finally{this._recordLastInfo(t,e)}}_getNodePositionLoc(t,e,n){if(t&&e){let o=this.containerInterface.getObjectOrNull(t);if(o===null)return this.data["connection.points"]&&this.data["connection.points"].length>n?{x:this.data["connection.points"][n].x,y:this.data["connection.points"][n].y}:{x:0,y:0};{let i=this._getPosLocation(o,e),s=si(o.renderer.group.attr("transform"));return{x:i.x+s.translateX,y:i.y+s.translateY}}}else{if(this.data["connection.points"]&&this.data["connection.points"].length>n)return{x:this.data["connection.points"][n].x,y:this.data["connection.points"][n].y};throw new Error("Invalid points value.")}}};var be=class extends Mt{constructor(t,e){super(t,"direct",e)}_create(){this.objects.line=this.group.append("line").attr("marker-end",`url(#${this.markerId})`),this.objects.wideLine=this.group.append("line").attr("class","wide-line").style("stroke","rgba(0, 0, 0, 0)"),this.objects.rect=this.group.append("rect"),this._createConnector()}_getLabelXY(t){let e=this._getSourceLoc(),n=this._getDestinationLoc();return{x:e.x+(n.x-e.x)/2,y:e.y+(n.y-e.y)/2+(this.data.fontSize-this.data.fontSize*t.length/2)}}_render(){let t=this.dataWrapper,e=this.data["connection.points"],n=this._getSourceLoc(),o=this._getDestinationLoc(),i={borderColor:t.get("borderColor"),borderWidth:t.get("borderWidth"),borderDash:t.get("borderDash"),text:t.get("text"),fill:t.get("connection.textBorderFill"),textBorderColor:t.get("connection.textBorderColor"),textBorderWidth:t.get("connection.textBorderWidth"),textBorderDash:t.get("connection.textBorderDash")};if(this._renderConnector(),this._renderMarker(),this._isChanged(n,o)&&this._updatePoints(n,o),this.objects.line.attr("x1",e[0].x).attr("y1",e[0].y).attr("x2",e[this.lastPointId].x).attr("y2",e[this.lastPointId].y).style("stroke",i.borderColor).style("stroke-width",i.borderWidth).style("stroke-dasharray",i.borderDash),this.objects.wideLine.attr("x1",e[0].x).attr("y1",e[0].y).attr("x2",e[this.lastPointId].x).attr("y2",e[this.lastPointId].y).style("stroke-width",Math.max(i.borderWidth,5)),this._createText(),i.text){let s=this._getBBox(),a=s.width+10,c=s.height+10;this.objects.rect.attr("x",s.x-5).attr("y",s.y-5).attr("width",a).attr("height",c).style("fill",i.fill).style("stroke",i.textBorderColor).style("stroke-width",i.textBorderWidth).style("stroke-dasharray",i.textBorderDash)}else this.objects.rect.style("fill","transparent").style("stroke","transparent")}};var br=20,Tt=10,wi=Tt/2,xe=class extends Mt{constructor(t,e){super(t,"elbow",e),this.adjusterList=[],this.elbowMap={top:this._topTo,bottom:this._bottomTo,left:this._leftTo,right:this._rightTo}}_create(){this.objects.polyline=this.group.append("polyline").attr("fill","none").attr("marker-end",`url(#${this.markerId})`),this.objects.wideLine=this.group.append("polyline").attr("fill","none").style("stroke","rgba(0, 0, 0, 0)"),this.objects.rect=this.group.append("rect"),this._createConnector();let t=this.data["connection.points"];t.length===2?this.refreshAdjustList():(this._recordLastInfo(this._getSourceLoc(),this._getDestinationLoc()),this._createAdjustList(t.slice(1,t.length-1)))}_getNextXY(t,e){switch(t){case"left":return{x:e.x-br,y:e.y};case"right":return{x:e.x+br,y:e.y};case"top":return{x:e.x,y:e.y-br};case"bottom":return{x:e.x,y:e.y+br};default:throw new Error(`Unknown pos '${t}'`)}}*_topTo(t,e,n,o,i){let s=(t.x+e.x)/2,a=(t.y+e.y)/2,c=(n.x+o.x)/2,l=(n.y+o.y)/2;switch(i){case"top":{yield{x:s,y:Math.min(n.y,o.y)};break}case"bottom":{t.y>e.y?yield{x:s,y:a}:(yield{x:(t.x+s)/2,y:n.y},yield{x:s,y:a},yield{x:(s+o.x)/2,y:o.y});break}case"left":{t.x<e.x?t.y<e.y&&(yield{x:(t.x+s)/2,y:n.y},yield{x:s,y:l}):t.y<e.y?(yield{x:c,y:n.y},yield{x:o.x,y:l}):(yield{x:c,y:a},yield{x:o.x,y:(a+o.y)/2});break}case"right":{t.x<e.x?t.y<e.y?(yield{x:c,y:n.y},yield{x:o.x,y:l}):(yield{x:c,y:a},yield{x:o.x,y:(a+o.y)/2}):t.y<e.y&&(yield{x:(n.x+s)/2,y:n.y},yield{x:s,y:l});break}default:throw new Error(`Unknown pos '${i}'`)}}*_bottomTo(t,e,n,o,i){let s=(t.x+e.x)/2,a=(t.y+e.y)/2,c=(n.x+o.x)/2,l=(n.y+o.y)/2;switch(i){case"top":{t.y<e.y?yield{x:s,y:a}:(yield{x:(t.x+s)/2,y:n.y},yield{x:s,y:a},yield{x:(s+o.x)/2,y:o.y});break}case"bottom":{yield{x:s,y:Math.max(n.y,o.y)};break}case"left":{t.y<e.y?t.x>e.x&&(yield{x:c,y:a},yield{x:o.x,y:(a+o.y)/2}):(yield{x:c,y:n.y},yield{x:o.x,y:l});break}case"right":{if(t.y<e.y){if(t.x<e.x){let h=(n.y+l)/2;yield{x:c,y:h},yield{x:o.x,y:(h+o.y)/2}}}else yield{x:c,y:n.y},yield{x:o.x,y:l};break}default:throw new Error(`Unknown pos '${i}'`)}}*_leftTo(t,e,n,o,i){let s=(t.x+e.x)/2,a=(t.y+e.y)/2,c=(n.x+o.x)/2,l=(n.y+o.y)/2;switch(i){case"top":{t.y<e.y?t.x<e.x&&(yield{x:n.x,y:(n.y+a)/2},yield{x:c,y:a}):t.x<e.x?(yield{x:n.x,y:l},yield{x:c,y:o.y}):(yield{x:s,y:l},yield{x:(s+o.x)/2,y:o.y});break}case"bottom":{t.y<e.y?t.x<e.x?(yield{x:n.x,y:l},yield{x:c,y:o.y}):(yield{x:s,y:l},yield{x:(s+o.x)/2,y:o.y}):t.x<e.x&&(yield{x:n.x,y:(n.y+a)/2},yield{x:c,y:a});break}case"left":{t.x<e.x?yield{x:n.x,y:a}:yield{x:o.x,y:a};break}case"right":{t.x<e.x?(yield{x:n.x,y:(n.y+a)/2},yield{x:c,y:a},yield{x:o.x,y:(a+o.y)/2}):yield{x:s,y:a};break}default:throw new Error(`Unknown pos '${i}'`)}}*_rightTo(t,e,n,o,i){let s=(t.x+e.x)/2,a=(t.y+e.y)/2,c=(n.x+o.x)/2,l=(n.y+o.y)/2;switch(i){case"top":{t.y<e.y?t.x>e.x&&(yield{x:n.x,y:(n.y+a)/2},yield{x:c,y:(a+o.y)/2}):t.x<e.x?(yield{x:s,y:l},yield{x:(s+o.x)/2,y:o.y}):(yield{x:n.x,y:l},yield{x:c,y:o.y});break}case"bottom":{t.y<e.y?t.x<e.x?(yield{x:s,y:l},yield{x:(s+o.x)/2,y:o.y}):(yield{x:n.x,y:l},yield{x:c,y:o.y}):t.x>e.x&&(yield{x:n.x,y:(n.y+a)/2},yield{x:c,y:a});break}case"left":{t.x<e.x?yield{x:s,y:a}:(yield{x:n.x,y:(n.y+a)/2},yield{x:c,y:a},yield{x:o.x,y:(a+o.y)/2});break}case"right":{yield{x:Math.max(n.x,o.x),y:a};break}default:throw new Error(`Unknown pos '${i}'`)}}_getElbowPoints(t,e,n,o){let i=this._getNextXY(n,t),s=this._getNextXY(o,e),a=[],c=this.elbowMap[n];if(a.push({x:t.x,y:t.y}),c===void 0)console.error(`unknown position value '${n}'`);else for(let l of c(t,e,i,s,o))a.push(l);return a.push({x:e.x,y:e.y}),a}_getPolylinePath(t){let e=[],n=t[0].x,o=t[0].y,i=this._getFirstPointDir()==="v";e.push([n,o]);for(let s=0;s<t.length-1;++s)i?o=t[s+1].y:n=t[s+1].x,e.push([n,o]),i=!i;return e.push([t[t.length-1].x,t[t.length-1].y]),e}_getLabelPos(t){let e=t[1],n=t[2];return{x:(e[0]+n[0])/2,y:(e[1]+n[1])/2}}_getPosToDir(t){switch(t){case"top":case"bottom":return"v";case"left":case"right":return"h";default:throw new Error(`Unknown sourcePos '${t}'`)}}_getFirstPointDir(){if(this.data["connection.sourcePos"]!==null)return this._getPosToDir(this.data["connection.sourcePos"]);{let t=this._getPos(this._getSourceLoc(),this._getDestinationLoc());return this._getPosToDir(t.srcPos)}}_createAdjustList(t){let e=this.data,n=this._getFirstPointDir()==="v";this.adjusterList.forEach(o=>o.remove()),this.adjusterList.splice(0,this.adjusterList.length),t.forEach((o,i)=>{let s=!n,a=0,c=0,l=null;n=!n;let h=this.group.append("rect").attr("x",o.x-Tt/2).attr("y",o.y-Tt/2).attr("width",Tt).attr("height",Tt).attr("class","adjuster").attr("cursor","move").call(q().filter(()=>this.containerInterface.getReadOnly()===!1).on("start",f=>{a=f.x,c=f.y,l=lr(this.data["connection.points"]),this.containerInterface.adjDragStartCallback()}).on("drag",f=>{let u=e["connection.points"],m=u[i+1];if(s){let O=a-f.x;m.x-=O,a=f.x,h.attr("x",m.x-Tt/2),i>0&&(u[i].x-=O/2),i+3<u.length&&(u[i+2].x-=O/2)}else{let O=c-f.y;m.y-=O,c=f.y,h.attr("y",m.y-Tt/2),i>0&&(u[i].y-=O/2),i+3<u.length&&(u[i+2].y-=O/2)}this._render()}).on("end",()=>{this.containerInterface.adjDragEndCallback(this.data,l,lr(this.data["connection.points"]))}));this.adjusterList.push(h)})}_getPos(t,e){let n={srcPos:this.data["connection.sourcePos"],desPos:this.data["connection.destinationPos"]},o=Math.abs(t.y-e.y),i=Math.abs(t.x-e.x);return n.srcPos||(o>i?n.srcPos=t.y>e.y?"top":"bottom":n.srcPos=t.x>e.x?"left":"right"),n.desPos||(o>i?n.desPos=t.y>e.y?"bottom":"top":n.desPos=t.x>e.x?"right":"left"),n}refreshAdjustList(){let t=this._getSourceLoc(),e=this._getDestinationLoc(),n=this._getPos(t,e),o=this._getElbowPoints(t,e,n.srcPos,n.desPos);this._createAdjustList(o.slice(1,o.length-1)),this._updatePoints(...o)}_getLabelXY(t){let e=this._getLabelPos(this._getPolylinePath(this.data["connection.points"]));return{x:e.x,y:e.y+(this.data.fontSize-this.data.fontSize*t.length/2)}}_renderAdjustList(){this.adjusterList.forEach((t,e)=>{let n=this.data["connection.points"][e+1];t.attr("x",n.x-wi).attr("y",n.y-wi),t.attr("visibility",this.group.classed("edit")===!1?this.subUiVisibility:"hidden"),this.bringToFrontElement(t.node())})}_render(){let t=this.data,e=this.dataWrapper,n=this._getSourceLoc(),o=this._getDestinationLoc();this._isChanged(n,o)&&this.refreshAdjustList(),this._renderConnector(),this._renderMarker(),this._renderAdjustList();let s=this._getPolylinePath(t["connection.points"]).map(a=>`${a[0]},${a[1]}`).join(", ");if(this.objects.polyline.attr("points",s).style("stroke",e.get("borderColor")).style("stroke-width",e.get("borderWidth")).style("stroke-dasharray",e.get("borderDash")),this.objects.wideLine.attr("points",s).style("stroke-width",Math.max(e.get("borderWidth"),5)),this._createText(),t.text){let a=this._getBBox(),c=a.width+10,l=a.height+10;this.objects.rect.attr("x",a.x-5).attr("y",a.y-5).attr("width",c).attr("height",l).style("fill",e.get("connection.textBorderFill")).style("stroke",e.get("connection.textBorderColor")).style("stroke-width",e.get("connection.textBorderWidth")).style("stroke-dasharray",e.get("connection.textBorderDash"))}else this.objects.rect.style("fill","transparent").style("stroke","transparent")}};var _e=class extends ut{constructor(t,e){super(t,"group",e)}_create(){this.objects.rect=this.group.append("rect").attr("fill","none").attr("visibility","hidden"),this.objects.thickRect=this.group.append("rect").attr("fill","none").attr("opacity","0").attr("visibility","hidden")}_render(){let t=this.data["group.rect"],e=this.dataWrapper;if(this.data.isSelected||this.data["group.borderAlwaysAppearance"]){let n=e.get("borderWidth");this.objects.rect.attr("x",t.x).attr("y",t.y).attr("width",t.width).attr("height",t.height).attr("stroke",e.get("borderColor")).attr("stroke-width",n).attr("stroke-dasharray",e.get("borderDash")).attr("visibility","visible"),this.objects.thickRect.attr("x",t.x).attr("y",t.y).attr("width",t.width).attr("height",t.height).attr("stroke","white").attr("stroke-width",Math.max(n,8)).attr("visibility","visible")}else this.objects.rect.attr("visibility","hidden"),this.objects.thickRect.attr("visibility","hidden")}};var we=class extends Y{constructor(t,e){super(t,"if",e)}_create(){this.objects.body=this.group.append("polygon"),super._create()}getPolygon(){let t=[],e=this.width/2,n=this.height/2;return t.push(`${-e},0`),t.push(`0,${-n}`),t.push(`${e},0`),t.push(`0,${n}`),t.join(" ")}_render(){let t=this.dataWrapper;this.objects.body.attr("points",this.getPolygon()).attr("fill",t.get("node.fill")).attr("stroke",t.get("borderColor")).attr("stroke-width",t.get("borderWidth")).attr("stroke-dasharray",t.get("borderDash")),this._createText()}};var ve=class extends Y{constructor(t,e){super(t,"return",e)}_create(){this.objects.body=this.group.append("rect"),super._create()}_render(){let t=this.dataWrapper,e=this.width,n=this.height;this.objects.body.attr("x",-(e/2)).attr("y",-(n/2)).attr("rx",t.get("node.borderRadius")).attr("width",e).attr("height",n).style("fill",t.get("node.fill")).attr("stroke",t.get("borderColor")).style("stroke-width",t.get("borderWidth")).attr("stroke-dasharray",t.get("borderDash")),this._createText()}};var Oe=class extends Y{constructor(t,e){super(t,"start",e)}_create(){this.objects.body=this.group.append("rect"),super._create()}_render(){let t=this.dataWrapper,e=this.objects,n=this.width,o=this.height;e.body.attr("x",-(n/2)).attr("y",-(o/2)).attr("rx",o/2).attr("width",n).attr("height",o).style("fill",t.get("node.fill")).style("stroke-width",t.get("borderWidth")).attr("stroke-dasharray",t.get("borderDash")).attr("stroke",t.get("borderColor")),this._createText()}};var Ce=class{constructor(){this.nodeRenderMap=new Map,this.connectionRenderMap=new Map,this.etcRenderMap=new Map,this.nodeRenderMap.set("start",Oe),this.nodeRenderMap.set("if",we),this.nodeRenderMap.set("return",ve),this.nodeRenderMap.set("comment",me),this.nodeRenderMap.set("bridge",ge),this.nodeRenderMap.set("db",ye),this.connectionRenderMap.set("direct",be),this.connectionRenderMap.set("elbow",xe),this.etcRenderMap.set("group",_e)}_add(t,e,n){t.set(e,n)}_get(t,e){if(t.has(e))return t.get(e);throw new Error(`There is no renderer (key: '${e}')`)}addRenderMap(t,e,n){switch(t){case"node":this._add(this.nodeRenderMap,e,n);break;case"connection":this._add(this.connectionRenderMap,e,n);break;default:throw new Error(`Unknown type '${t}'`)}}getRenderConstructor(t,e){switch(t){case"node":return this._get(this.nodeRenderMap,e);case"connection":return this._get(this.connectionRenderMap,e);default:return this._get(this.etcRenderMap,e)}}changeRender(t,e,n){let o=this.getRenderConstructor(t.type,e),i=new o(t.data,n);t.changeRender(e,i)}};var Se=class{constructor(t){this.objSeq=0,this.clickSeq=0,this.iContainer=t,this.clear()}clear(){this.clearObjSeq(),this.clearClickSeq()}clearObjSeq(){this.objSeq=1}clearClickSeq(){this.clickSeq=0}getObjSeqId(){for(;this.iContainer.getObjectOrNull(this.objSeq)!==null;)++this.objSeq;return this.objSeq}increaseClickSeq(){return++this.clickSeq}};var vi={...sr,...ar,...cr,...bt};function Oi(r){return new Promise((t,e)=>{let n=new Image;n.onerror=o=>e(o),n.src=r,n.onload=()=>{let o=document.getSelection();if(!o){e("selection is null when copying image");return}let i=document.createRange();document.body.appendChild(n),i.selectNode(n),o.removeAllRanges(),o.addRange(i),document.execCommand("copy"),n.remove(),t()}})}var xr=10,ac=255,_r=["left","right","top","bottom"],Ci=8,Si=.4,ji=3,cc=new Set(["isHovered","isSelected"]),lc=r=>{let t={};return{emit:(e,n)=>{t[e]&&t[e].forEach(o=>o.apply(r,n))},on:(e,n)=>(t[e]||(t[e]=[]),t[e].push(n),n),off:(e,n)=>{if(!t[e])return!1;let o=t[e].indexOf(n);return o<0?!1:(t[e].splice(o,1),!0)}}},hc=r=>{let t=document.createElement("div"),e=document.createElementNS("http://www.w3.org/2000/svg","svg");return e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.style.background="#fff",t.classList.add("flowchart"),t.tabIndex=0,e.innerHTML=`
<defs>
    <pattern
        id="${r}_small_grid"
        width="10"
        height="10"
        patternUnits="userSpaceOnUse">
        <path
        d="M 10 0 L 0 0 0 10"
        fill="none"
        stroke="gray"
        stroke-width="0.5"/>
    </pattern>
    <pattern
        id="${r}_grid"
        width="100"
        height="100"
        patternUnits="userSpaceOnUse">
        <rect
        width="100"
        height="100"
        fill="url(#${r}_small_grid)"/>
        <path
        d="M 100 0 L 0 0 0 100"
        fill="none"
        stroke="gray"
        stroke-width="1"/>
    </pattern>
</defs>`,t.appendChild(e),{div:t,svg:e}},wr=10,Ii=class extends sn{constructor({contextElement:t,width:e,height:n,fitSizeMode:o}){super({contextElement:t}),this._wheelZoom=!0,this._gridMode=!1,this._editMode=!1,this._readonly=!1,this._simpleConnectingMode=!1,this._moveScreenOnSelect=!1,this._selectNodeOnHover=!1,this._tooltipHidden=!1,this._traceMode=!1,this._singleSelection=!1,this._isChanged=!1,this._isDragging=!1,this._canvasMoveMode=!1,this._fitSizeMode=o!=null?o:!1,this.keyMap={},this.keyMap.ArrowLeft=()=>this.handleKeydownArrows(-wr,0),this.keyMap.ArrowRight=()=>this.handleKeydownArrows(wr,0),this.keyMap.ArrowDown=()=>this.handleKeydownArrows(0,wr),this.keyMap.ArrowUp=()=>this.handleKeydownArrows(0,-wr),this.keyMap.Delete=()=>this.handleKeydownDelete(),this.keyMap.Escape=()=>this.handleKeydownEscape(),this.keyMap.F2=()=>this.handleKeydownF2(),this.keyMap["^x"]=()=>this.cut(),this.keyMap["^c"]=()=>this.copy(),this.keyMap["^v"]=()=>this.paste(),this.keyMap["^z"]=()=>this.undoAction(),this.keyMap["^y"]=()=>this.redoAction(),this.keyMap["^a"]=()=>this.selectAllObjects(),this.keyMap["^A"]=()=>this.selectAllObjects(),this._appendMode={mode:null,data:null,dragged:!1},this._wrapperSize={width:0,height:0},this._svgSize={width:0,height:0},this._appendingObject=null,this.emitter=lc(this);let{div:i,svg:s}=hc(this.uuid);this.div=i,i.addEventListener("keydown",a=>{if(this._editMode||this._readonly){this._logger.debug("InnoFlowchart.handleKeydown()","Cancel because of editMode or readonly mode");return}let c=`${a.ctrlKey?"^":""}${a.key}`;c in this.keyMap&&(this.keyMap[c](a),a.preventDefault())}),this.addCoreElement(i),t.appendChild(i),this._initD3Elements(i,s,e,n),this._containerInterface=new yr({releaseAllObjects:()=>this.releaseAllObjects(),addRenderObj:a=>this.add(a),removeObject:a=>this.remove(a),initDrag:a=>this._initDrag(a),terminateDrag:a=>this._terminateDrag(a),isDragging:()=>this._isDragging,changeObjRender:(a,c)=>this._changeObjRender(a,c),adjDragStartCallback:()=>this._adjDragStartCallbackHandler(),adjDragEndCallback:(a,c,l)=>this._adjDragEndCallbackHandler(a,c,l),editTextCallback:(a,c,l)=>this._editTextCallbackHandler(a,c,l),editTextModeCallback:a=>this._editTextModeCallback(a),renderCallback:a=>this._renderCallBack(a),observerCallback:a=>this._observerCallback(a),selectCallback:(a,c,l)=>this._selectCallbackHandler(a,c,l),releaseCallback:(a,c)=>this._releaseCallbackHandler(a,c),setEditMode:a=>this._editMode=a,getLogger:()=>this._logger,getSvg:()=>this.d3Svg,getObjectOrNull:a=>this.getObjectOrNull(a),getSelectNodeOnHover:()=>this._selectNodeOnHover,getTooltipHidden:()=>this._tooltipHidden,getReadOnly:()=>this._readonly,isAppending:()=>this._appendMode.mode==="append",getUUID:()=>this.uuid}),this._seqMng=new Se(this._containerInterface),this._objectManager=new xi,this._actionController=new or(this._containerInterface,ac),this._moveHandler=new dr(this._actionController,this._objectManager,this._containerInterface),this._resizeHandler=new ur(this._actionController,this._objectManager,this._containerInterface),this._renderManager=new Ce,this._objMouseHandler=new pe(this._containerInterface),this.theme={...vi},this.defaultRule=ai,this._cursorStatus={curPosX:0,curPosY:0,isDragging:!1},this.zoomTo(1),this.render()}get svgElement(){return this.d3Svg.node()}get actionController(){return this._actionController}get readonly(){return this._readonly}get simpleConnectingMode(){return this._simpleConnectingMode}get editMode(){return this._editMode}get gridMode(){return this._gridMode}get tooltipHidden(){return this._tooltipHidden}get fitSizeMode(){return this._fitSizeMode}get moveScreenOnSelect(){return this._moveScreenOnSelect}get selectNodeOnHover(){return this._selectNodeOnHover}get wheelZoom(){return this._wheelZoom}get traceMode(){return this._traceMode}get singleSelection(){return this._singleSelection}set readonly(t){this._readonly=t,this.classedOnSvg(t,"readonly"),this._logger.info(`readonly property is changed to '${t}'`)}set simpleConnectingMode(t){this._simpleConnectingMode=t,this.classedOnSvg(t,"simple"),this._logger.info(`simpleConnectingMode property is changed to '${t}'`)}set editMode(t){this._editMode=t,this.classedOnSvg(t,"edit-mode"),this._logger.info(`editMode property is changed to '${t}'`)}set gridMode(t){this._gridMode=t,this.d3Grid.attr("visibility",this._gridMode?"visible":"hidden"),this.classedOnSvg(t,"flowchart-grid"),this._logger.info(`gridMode property is changed to '${t}'`),this.render()}set tooltipHidden(t){this._tooltipHidden=t,this.classedOnSvg(t,"tooltip-hidden"),this._logger.info(`tooltipHidden property is changed to '${t}'`)}set moveScreenOnSelect(t){this._moveScreenOnSelect=t,this.classedOnSvg(t,"move-screen-on-select"),this._logger.info(`moveScreenOnSelect property is changed to '${t}'`)}set selectNodeOnHover(t){this._selectNodeOnHover=t,this.classedOnSvg(t,"select-node-on-hover"),this._logger.info(`selectNodeOnHover property is changed to '${t}'`)}set wheelZoom(t){this._wheelZoom=t,this.classedOnSvg(t,"wheel-zoom"),this._logger.info(`wheelZoom property is changed to '${t}'`)}set traceMode(t){this._logger.logLevel=t?"INFO":"ERROR",this._traceMode=t,this.classedOnSvg(t,"trace"),this._logger.info(`traceMode property is changed to '${t}'`)}set singleSelection(t){this._singleSelection=t,this.classedOnSvg(t,"single-select"),this._logger.info(`singleSelection property is changed to '${t}'`)}set canvasMoveMode(t){this._canvasMoveMode=t,this.classedOnSvg(t,"canvas-move"),this._logger.info(`canvasMoveMode property is changed to '${t}'`)}_initD3Elements(t,e,n,o){this._logger=hi(this.uuid),t.addEventListener("contextmenu",c=>{this.$emit(z.CONTEXT_MENU,c),c.preventDefault()});let i=isNaN(n)?n:`${n}px`,s=isNaN(o)?o:`${o}px`;this.d3Div=F(t).style("width",i).style("height",s),this.d3Svg=F(e).on("mousemove",c=>this._mouseMoveOnSheetHandler(c)).on("click",c=>this._clickOnSheetHandler(c)).call(q().filter(()=>this._editMode===!1).on("start",c=>this._dragController(c)).on("drag",c=>this._dragController(c)).on("end",c=>this._dragController(c))),this.d3Grid=this.d3Svg.append("g").attr("transform","translate(-1, -1)").attr("class","flowchart-grid").append("rect").attr("width","100%").attr("height","100%").attr("fill",`url(#${this.uuid}_grid)`).attr("visibility","hidden"),this.d3Container=this.d3Svg.append("g").attr("class","container");let a=Vr().filter(c=>this._wheelZoom&&c.type==="wheel"&&c.ctrlKey).wheelDelta(c=>-c.deltaY*(c.deltaMode===1?.05:c.deltaMode?1:.002)).scaleExtent([Si,ji]).on("zoom",c=>this.zoomTo(c.transform.k));this.d3Div.call(a).on("dblclick.zoom",null),this.selection={rect:null,startX:0,startY:0}}$emit(t,...e){this.emitter.emit(t,e)}$on(t,e){return this.emitter.on(t,e)}$off(t,e){return this.emitter.off(t,e)}moveWrapper(t){try{this._moveHandler.moveStartHandler(),t(),this._updateNegativePos()}finally{this._moveHandler.moveEndHandler(),this.refreshSvgSize()}}addSvgDefs(t){this.d3Svg.node().appendChild(t)}addLinearGradientDefs(t,e,n,o){if(typeof n.length!="number"||typeof o.length!="number")throw new Error("it must be an array type both offsets and colors!");let i=document.createElementNS("http://www.w3.org/2000/svg","defs"),s=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");s.id=t,s.setAttribute("gradientTransform",`rotate(${e})`),ln(n,o).forEach(([a,c])=>{let l=document.createElementNS("http://www.w3.org/2000/svg","stop");l.setAttribute("offset",a),l.setAttribute("stop-color",c),s.appendChild(l)}),i.appendChild(s),this.addSvgDefs(i)}add(t,e=void 0){switch(t.type){case void 0:throw this._logger.error("InnoFlowchart.add()","undefined type prop"),new Error("Object that you added needs 'type' property! (node or connection)");case"group":t.render="group";break;default:break}if(t.render===void 0)throw this._logger.error("InnoFlowchart.add()","undefined render prop"),new Error("Object that you added needs 'render' property!");if(!t.id)t.id=this._seqMng.getObjSeqId();else switch(typeof t.id){case"number":case"string":break;default:throw this._logger.error("InnoFlowchart.add()","Not allowed id type (USE STRING OR NUMBER)"),new Error("Data's id is only allowed string or nubmer type!")}if(this._objectManager.findOrNull(t.id)!==null)throw this._logger.error("InnoFlowchart.add()","duplicated object id"),new Error(`Object's id is already created! (${t.id})`);this.defaultRule(t),Kr(t,this.theme);let n=null,o=this._renderManager.getRenderConstructor(t.type,t.render),i=new o(t,this._containerInterface);switch(t.type){case"connection":n=new ui(t,i,this._containerInterface);break;case"node":n=new yi(t,i,this._containerInterface);break;case"group":n=new fi(t,i,this._containerInterface);break;default:throw Error(`unkown data type '${t.type}'`)}return this._objectManager.add(n),n.create(),this.refreshSvgSize(),e!==void 0&&this.d3Container.node().insertBefore(n.g.node(),this._getChildElementOrNull(e)),t.temp?this._logger.debug("InnoFlowchart.add()",`created temp obj id is '${n.id}'`):(this._addObjectEvent(n),this.emitChangedStatus(),this.$emit(z.NEW_OBJECT,n),this._logger.debug("InnoFlowchart.add()",`created obj id is '${n.id}'`)),n}remove(t){if(t==null)throw this._logger.error("InnoFlowchart.remove()","Object could not be null or undefined to remove!"),new Error("Object could not be null or undefined to remove!");let e=null;switch(typeof t){case"string":case"number":e=this.getObjectOrNull(t);break;case"object":e=this.getObjectOrNull(t.id);break;default:throw Error(`unkown data type '${typeof t}'`)}if(e!=null)e.destroy(),this.emitChangedStatus(),this._objectManager.remove(e),this.refreshSvgSize(),this._objMouseHandler.removeTooltipObj(),e.isTempObj?this._logger.debug("InnoFlowchart.remove()",`Removed temp obj id is '${e.id}'`):(this.$emit(z.REMOVE_OBJECT,e),this._logger.debug("InnoFlowchart.remove()",`Removed obj id is '${e.id}'`));else throw new Error("There is no such as object you received in this flowchart!")}zoomTo(t){if(t<Si||t>ji)return;this._logger.info("InnoFlowchart.zoomTo",`scale is changed to ${t}`),this.d3Div.node().__zoom.k=t,this.d3Container.attr("transform",`scale(${t})`);let e=`${1/t*100}%`;this.d3Grid.attr("transform",`scale(${t})`).attr("width",e).attr("height",e),this.refreshSvgSize()}recordNewObjectsAction(...t){this._actionController.addAction(new Z(xt(t))),this._updateNegativePos()}emitChangedStatus(){this._isChanged||(this._isChanged=!0,this.classedOnSvg(!0,"changed"))}getScale(){return this.getTransform().k}getSelectedConnections(t=!0){let e=[];for(let n of this._objectManager.getConnectionIterator())n.isSelected&&e.push(n);return t&&e.sort((n,o)=>n.clickedSeq-o.clickedSeq),e}_editObjProp(t){t.forEach(e=>{for(let n of e.propList)n.oldValue===void 0&&(n.oldValue=e.objData[n.key]),e.objData[n.key]=n.newValue}),this._actionController.addAction(new V(t))}editSelectedObjProp(t,e){let n=[];for(let o of this._objectManager.getSelectedObjIterator())o.isSelected&&n.push(new X(o.data,[{key:t,newValue:e}]));this._editObjProp(n)}append(t,e){if(this._readonly){this._logger.info("InnoFlowchart.append()","Preventing append (readonly: true)");return}if(this._validateAppendMode({mode:t,data:e}))this.clearAppendMode(),this._appendMode.mode=t,this._appendMode.data=e,this.classedOnSvg(!0,`is-appending-${e.type}`),this._logger.info("InnoFlowchart.append()","Append Mode",this._appendMode.mode);else throw this._logger.error("InnoFlowchart.append()","Invalid append info!"),new Error("Invalid append info!")}resetScreen(){let t=this.d3Div.node();t.scrollLeft=0,t.scrollTop=0}getWrapperSize(){let t=this.d3Div.node();if(!t)throw new Error("there is no wrapper div");let{width:e,height:n}=t.getBoundingClientRect();return{width:e,height:n}}getTransform(){return le(this.d3Div.node())}updateMinimumSvgSize(){let t=this.getWrapperSize();this._wrapperSize.width=parseInt(t.width),this._wrapperSize.height=parseInt(t.height),this.refreshSvgSize()}_getFlowchartAvailableRect(){let t=this.getTransform().k,e={top:999999999,left:999999999,right:0,bottom:0};for(let n of this._objectManager.getAllObjIterator())e.top=Math.min(e.top,n.startY),e.left=Math.min(e.left,n.startX),e.right=Math.max(e.right,n.endX),e.bottom=Math.max(e.bottom,n.endY);return e.top*=t,e.left*=t,e.right*=t,e.bottom*=t,e}updateSvgSize(){let t=this._svgSize.width,e=this._svgSize.height;this._fitSizeMode||(t+=this._wrapperSize.width/2,e+=this._wrapperSize.height/2),this.d3Svg.attr("width",Math.max(this._wrapperSize.width,t)).attr("height",Math.max(this._wrapperSize.height,e))}refreshSvgSize(){let t=this._getFlowchartAvailableRect();this._svgSize.width=t.right,this._svgSize.height=t.bottom,this._logger.info("InnoFlowchart.refreshSvgSize()",t),this.updateSvgSize()}render(){this.updateMinimumSvgSize()}getObjectList(){let t=[];for(let e of this._objectManager.getAllObjIterator())!e.isTempObj&&t.push(e);return t}clearActionList(){this._logger.info("InnoFlowchart.clearActionList()"),this._actionController.clear()}undoAction(){if(this._readonly){this._logger.info("InnoFlowchart.undoAction()","Preventing undo (readonly: true)");return}let t=this._actionController.undo();this._logger.debug("InnoFlowchart.undoAction()",t),t!==null&&(this.refreshSvgSize(),this.$emit(z.UNDO,t))}redoAction(){if(this._readonly){this._logger.info("InnoFlowchart.redoAction()","Preventing redo (readonly: true)");return}let t=this._actionController.redo();this._logger.debug("InnoFlowchart.redoAction()",t),t!==null&&(this.refreshSvgSize(),this.$emit(z.REDO,t))}_objectClickHandler(t,e){this._logger.info(`InnoFlowchart.event.emit.${e}`,t),t.select(!0),this.$emit(e,t)}_commonObserveCallback(t){switch(t.key){case"id":{let e=this.getObjectOrNull(t.oldValue);e!==null&&this._objectManager.reassignId(e,t.oldValue,t.newValue);break}case"isSelected":{t.newValue&&(t.renderObj.clickedSeq=this._seqMng.increaseClickSeq());break}default:break}}_connectionObserveCallback(t){let e=t.renderObj;switch(t.key){case"connection.sourceObjId":t.oldValue!==null&&t.newValue===null&&this.$emit(z.DISCONNECT_NODE,e,t.key);break;case"connection.sourcePos":e.sourceObjId!==null&&this.$emit(z.CONNECT_NODE,e,t.key);break;case"connection.destinationObjId":t.oldValue!==null&&t.newValue===null&&this.$emit(z.DISCONNECT_NODE,e,t.key);break;case"connection.destinationPos":e.destinationObjId!==null&&this.$emit(z.CONNECT_NODE,e,t.key);break;default:break}}_observerCallback(t){t.newValue!==t.oldValue&&(!this._isChanged&&!cc.has(t.key)&&this.emitChangedStatus(),this._commonObserveCallback(t),t.renderObj.type==="connection"&&this._connectionObserveCallback(t))}_selectCallbackHandler(t,e,n){let o=this._objectManager.getParentGroupOrNull(t);if(e&&(this._moveScreenOnSelect&&t.type==="node"&&this.moveScreenByObject(t),this._singleSelection))for(let i of this._objectManager.getSelectedObjIterator())i!==t&&i.release();o!==null&&o.select(!1,n),this._logger.info("InnoFlowchart._selectCallbackHandler()",t),this.$emit(z.SELECT_OBJECT,t)}_releaseCallbackHandler(t,e){this.$emit(z.RELEASE_OBJECT,t)}_editTextModeCallback(){this._objMouseHandler.removeTooltipObj()}_getXYOnSheet(t,e){let n=1/this.getTransform().k;return{x:t*n,y:e*n}}_validateAppendMode({mode:t,data:e}){switch(t){case"append":return e.type==="node"||e.type==="connection";case"paste":return e.objects.length>0;default:return!1}}_getProperlyPointsToCreate(t){let e=t["connection.points"];t:for(;;){for(let n of this._objectManager.getConnectionIterator())if(n.comparePoints(e)){e.forEach(o=>{o.x+=10,o.y+=10});continue t}return e}}_getProperlyNodePosToCreate(t){let e=t["node.x"],n=t["node.y"];t:for(;;){for(let o of this._objectManager.getNodeIterator())if(o.x===e&&o.y===n){e+=10,n+=10;continue t}return{"node.x":e,"node.y":n}}}_initAppendObj(){switch(this._appendMode.data.type){case"node":{this._appendingObject=this.add({...this._appendMode.data,temp:!0,id:"appending_temp_obj",opacity:0});break}default:break}}_mouseMoveOnSheetHandler(t){let e=t.offsetX,n=t.offsetY;if(this._validateAppendMode(this._appendMode)){switch(this._appendMode.mode){case"append":this._appendingObject===null?this._initAppendObj():this._appendingObject.type==="node"&&this._moveAppendingNode(e,n);break;default:break}this.d3Div.node().focus()}}_setZIndexOnSelected(t){let e=[],n=t==="front"?this._objectManager.getObjCount():0;this._logger.info("InnoFlowchart.setZIndex()",`new z-index = ${n}`);for(let o of this.getSelectedObjects())e.push({objId:o.id,oldValue:o.zIndex+(t==="back"?1:0),newValue:n}),o.zIndex=n;this.emitChangedStatus(),this._actionController.addAction(new $t(e))}bringToFront(){this._logger.info("InnoFlowchart.bringToFront()"),this._setZIndexOnSelected("front")}bringToBack(){this._logger.info("InnoFlowchart.bringToBack()"),this._setZIndexOnSelected("back")}_moveSelectedObjects(t,e){for(let n of this._objectManager.getSelectedObjIterator())n.moveTo(t,e)}getObjectOrNull(t){return this._objectManager.findOrNull(t)}selectObjectById(t){let e=this.getObjectOrNull(t);if(e!=null)e.select();else throw new Error(`Not found obj id '${t}'`)}_addCommonMouseAction(t){this._objMouseHandler.addMouseAction(t)}_isSingleSelection(t){return this._singleSelection||!t}_addClickActionOnNode(t){t.g.on("dblclick",()=>{t.data.editable&&this._readonly===!1&&t.renderer.editLabelMode(),this._logger.info("InnoFlowchart.event.emit.dblClickNode",t),this.$emit(z.DOUBLE_CLICK_NODE,t)})}classedOnSvg(t,...e){e.forEach(n=>this.d3Svg.classed(n,t)),this.$emit(z.CHANGE_CLASS,this.d3Svg.attr("class"))}_addDragActionOnNode(t){let e=!1,n=0,o=0,i=0,s=0;t.g.call(q().filter(()=>this._editMode===!1).on("start",a=>{this._isSingleSelection(a.sourceEvent.ctrlKey)&&!t.isSelected&&this.releaseAllObjects(t),e=!1,n=a.x,o=a.y,i=t.width-(t.endX-a.x),s=t.height-(t.endY-a.y),t.select(!1)}).on("drag",a=>{if(this._readonly)return;let c=a.x-i,l=a.y-s,h=c-t.x,f=l-t.y;!e&&Math.abs(n-a.x)+Math.abs(o-a.y)>8&&(e=!0,this._moveHandler.moveStartHandler(),this._initDrag("drag-node-move")),e&&this._moveSelectedObjects(h,f)}).on("end",a=>{if(e)this._moveScreenOnSelect&&t.type==="node"&&this.moveScreenByObject(t),this._moveHandler.moveEndHandler(),this._terminateDrag("drag-node-move");else{if(this._editMode)return;this._isSingleSelection(a.ctrlKey)&&this.releaseAllObjects(t),this._objectClickHandler(t,z.CLICK_NODE)}}))}_addDragActionOnConnector(t){for(let e of t.renderer.connectors){let n=ii(e.attr("class"));e.call(q().filter(()=>this._readonly===!1).on("start",o=>{let i=t.x+t.width/2+o.x,s=t.y+t.height/2+o.y,a=this._appendMode.data.render,c=t.getPositionXY(n);this._initDrag("drag-node-connector"),this._createAppendingConnection(c.x,c.y,i,s,{type:"connection",render:a,"connection.sourceObjId":t.id,"connection.sourcePos":n})}).on("drag",o=>{if(this._appendingObject===null)return;let i=t.x+t.width/2+o.x,s=t.y+t.height/2+o.y;this._appendMode.dragged=!0,this._moveAppendingConnection(i,s)}).on("end",()=>{this._appendingObject!==null&&(this._endAppendingConnection(),this._terminateDrag("drag-node-connector"))}))}}_addNodeEvent(t){this._addClickActionOnNode(t),this._addDragActionOnNode(t),this._addDragActionOnConnector(t),this._resizeHandler.addDragActionOnResizer(t)}_addClickActionOnConnection(t){t.g.on("click",e=>{this._isSingleSelection(e.ctrlKey)&&this.releaseAllObjects(t),this._objectClickHandler(t,"clickConnection")}),t.g.on("dblclick",()=>{t.data.editable&&this._readonly===!1&&t.renderer.editLabelMode(),this._logger.info("InnoFlowchart.event.emit.dblClickConnection",t),this.$emit(z.DOUBLE_CLICK_CONNECTION,t)})}_addDragActionOnConnection(t){let e=0,n=0,o=!1;t.g.call(q().filter(()=>this._editMode===!1).on("start",i=>{this._isSingleSelection(i.sourceEvent.ctrlKey)&&!t.isSelected&&this.releaseAllObjects(t),e=i.x,n=i.y,o=!1,t.select()}).on("drag",i=>{if(this._readonly)return;let s=i.x-e,a=i.y-n;if(!o&&Math.abs(s)+Math.abs(a)>5&&(o=!0,this._moveHandler.moveStartHandler(),this._initDrag("drag-con-move")),!!o){if(t.sourceObjId!==null){let c=this.getObjectOrNull(t.sourceObjId);(c===null||c.isSelected===!1)&&(t.sourceObjId=null)}if(t.destinationObjId!==null){let c=this.getObjectOrNull(t.destinationObjId);(c===null||c.isSelected===!1)&&(t.destinationObjId=null)}this._moveSelectedObjects(s,a),e=i.x,n=i.y}}).on("end",()=>{this._moveHandler.moveEndHandler(),this._terminateDrag("drag-con-move")}))}_addDragActionOnConnectionConnector(t){let e=(n,o,i)=>q().filter(()=>this._editMode===!1&&this._readonly===!1).on("start",()=>{this._moveHandler.moveStartHandler(),this._initDrag("drag-con-connector")}).on("drag",s=>{let a=this._getNodeAndPosUnderXY(s.x,s.y,this._simpleConnectingMode),c=i==="start"?t.firstPoint:t.endPoint;a.node===null?(t[n]=null,t[o]=null,c.x=s.x,c.y=s.y):(t[n]=a.node.id,this._simpleConnectingMode?this._setShortestPosition(t):t[o]=a.pos),t.renderType==="elbow"&&t.renderer.refreshAdjustList(),t.render()}).on("end",()=>{this._moveHandler.moveEndHandler(),this._terminateDrag("drag-con-connector")});t.renderer.objects.sourceConnector.call(e("sourceObjId","sourcePos","start")),t.renderer.objects.destinationConnector.call(e("destinationObjId","destinationPos","end"))}_addConnectionEvent(t){this._addClickActionOnConnection(t),this._addDragActionOnConnection(t),this._addDragActionOnConnectionConnector(t)}_addGroupEvent(t){let e=!1,n=0,o=0,i=0,s=0;t.g.call(q().filter(()=>this._editMode===!1&&this._readonly===!1).on("start",a=>{this._isSingleSelection(a.sourceEvent.ctrlKey)&&!t.isSelected&&this.releaseAllObjects(t),e=!1,n=a.x,o=a.y,i=a.x,s=a.y,t.select()}).on("drag",a=>{!e&&Math.abs(n-a.x)+Math.abs(o-a.y)>8&&(e=!0,this._moveHandler.moveStartHandler(),this._initDrag("drag-group-move")),e&&(this._moveSelectedObjects(a.x-i,a.y-s),i=a.x,s=a.y)}).on("end",()=>{this._moveHandler.moveEndHandler(),this._terminateDrag("drag-group-move")}))}_addObjectEvent(t){switch(this._addCommonMouseAction(t),t.type){case"node":this._addNodeEvent(t),t.render();break;case"connection":this._addConnectionEvent(t);break;case"group":this._addGroupEvent(t);break;default:throw new Error(`Unknown data type '${t.type}'`)}}_initDrag(t){this._isDragging=!0,this._appendMode.dragged=!1,this._objMouseHandler.removeTooltipObj(),this.classedOnSvg(!0,t)}_terminateDrag(t){this._isDragging=!1,this._appendMode.dragged=!1,this.classedOnSvg(!1,t),this.clearAppendMode(),this._updateNegativePos(),this.refreshSvgSize(),this._simpleConnectingMode&&this.updateShortestNodes()}_updateNegativePos(){let t={x:0,y:0,objX:null,objY:null};for(let e of this._objectManager.getAllObjIterator())e.startX<t.x&&(t.x=e.startX,t.objX=e),e.startY<t.y&&(t.y=e.startY,t.objY=e);if(t.x<0||t.y<0){let e=this._actionController.popLastUndoAction(),n=[],o=t.x<0?-t.x:0,i=t.y<0?-t.y:0;for(let s of this._objectManager.getNodeIterator()){let a=new X(s.data,[]);a.addMoveOldValues(),s.moveTo(o,i),a.updateMoveNewValues(),n.push(a)}for(let s of this._objectManager.getConnectionIterator())if(s.sourceObj===null||s.destinationObj===null){let a=new X(s.data,[]);a.addMoveOldValues(),s.moveTo(o,i),a.updateMoveNewValues(),n.push(a)}for(let s of this._objectManager.getGroupIterator())s.render();e&&(e.unshift(new V(n)),this._actionController.addAction(...e)),this.refreshSvgSize()}}getCountOfSelectedObject(){let t=0;for(let e of this._objectManager.getSelectedObjIterator())this._objectManager.getParentGroupOrNull(e)==null&&e.isSelected&&++t;return t}selectAllObjects(){if(!this._singleSelection)for(let t of this._objectManager.getAllObjIterator())t.type!=="group"&&t.select(!0)}releaseAllObjects(t){for(let e of this._objectManager.getAllObjIterator())t!==e&&e.release(!0)}align(t,e){let n=e||this.getSelectedNodes();if(!(n.length<=1)){switch(this._moveHandler.moveStartHandler(),t){case"left":{let o=n[0].x;n.forEach(i=>i.x=o);break}case"right":{let o=n[0].endX;n.forEach(i=>i.x=o-i.width);break}case"center":{let o=n[0].centerX;n.forEach(i=>i.x=o-i.width/2);break}case"top":{let o=n[0].y;n.forEach(i=>i.y=o);break}case"bottom":{let o=n[0].endY;n.forEach(i=>i.y=o-i.height);break}case"middle":{let o=n[0].centerY;n.forEach(i=>i.y=o-i.height/2);break}default:throw new Error(`Unknown direct '${t}'`)}this._moveHandler.moveEndHandler()}}distribute(t,e){let n=e||this.getSelectedNodes(!1);if(n.length<=1)return;let o=t==="h"?{start:"x",center:"centerX",end:"endX",size:"width"}:{start:"y",center:"centerY",end:"endY",size:"height"};n.sort((l,h)=>l[o.center]-h[o.center]),this._moveHandler.moveStartHandler();let i=n.length-1,s=n[0][o.end],a=n[i][o.start],c=n.slice(1,i).reduce((l,h)=>l-h[o.size],a-s)/i;n.slice(1,i).reduce((l,h)=>(h[o.start]=l,l+h[o.size]+c),s+c),this._moveHandler.moveEndHandler()}getSelectedObjects(t=!0){let e=Array.from(this._objectManager.getSelectedObjIterator());return t&&e.sort((n,o)=>n.clickedSeq-o.clickedSeq),e}removeSelected(){let t=this.getSelectedObjects(!1);t.forEach(e=>this.remove(e)),this._actionController.addAction(new kt(xt(t)))}_getChildElementOrNull(t){let e=this.d3Container.node();return t>=e.children.length?null:e.children[t]}_getNodeAndPosUnderXY(t,e,n=!1){for(let o of this._objectManager.getNodeIterator())if(o.isConnectorEnabled)if(n){if(new Ht(o.x,o.y,o.endX,o.endY).isContained(t,e))return{node:o,pos:"left"}}else for(let i of _r){let s=o.getPositionXY(i);if(new Ht(s.x-xr,s.y-xr,s.x+xr,s.y+xr).isContained(t,e))return{node:o,pos:i}}return{node:null,pos:null}}moveSelectedNode(t,e){for(let n of this._objectManager.getNodeIterator())n.isSelected&&(n.x=parseInt((n.x+t)/5)*5,n.y=parseInt((n.y+e)/5)*5)}getSelectedNodes(t=!0){let e=[];for(let n of this._objectManager.getNodeIterator())n.isSelected&&e.push(n);return t&&e.sort((n,o)=>n.clickedSeq-o.clickedSeq),e}getNodeConnections(t){let e=t.observeProperties?t.id:t,n=this.getObjectOrNull(e),o=Array.from(this._objectManager.getConnectedConnections(e));return o.sort((i,s)=>Gr(n,i)-Gr(n,s)),o}moveScreenByObject(t){let e=this.getTransform().k;this.d3Div.node().scrollLeft=t.centerX*e-this._wrapperSize.width/2,this.d3Div.node().scrollTop=t.centerY*e-this._wrapperSize.height/2}async copyToClipboard(t="image/png"){this.releaseAllObjects();let e=await Cr(Or(this.svgElement)),n=await Sr(e,t,this._getFlowchartRect(),Ci),o=await an(n);await Oi(o)}_getFlowchartRect(){let{top:t,left:e,bottom:n,right:o}=this._getFlowchartAvailableRect();return{x:e-1,y:t-1,width:o-e+2,height:n-t+2}}async saveAsImageFile(t,e="image/png"){this.releaseAllObjects();let n=await this.getBlob(e),o=URL.createObjectURL(n);try{cn(o,t)}finally{URL.revokeObjectURL(o)}}async getBlob(t="image/png"){let e=await Cr(Or(this.svgElement));return await Sr(e,t,this._getFlowchartRect(),Ci)}clearAppendMode(){this._appendMode.data&&this.classedOnSvg(!1,`is-appending-${this._appendMode.data.type}`),this._appendingObject!==null&&this.remove(this._appendingObject),this._appendMode.mode=null,this._appendMode.data=null,this._appendMode.dragged=!1,this._appendingObject=null}_getClipInfo(){let t=[];for(let e of this._objectManager.getSelectedObjIterator())e.type==="group"&&(e.data.objectList=Array.from(e.objectSet)),t.push(e.data);return{copyDateTime:new Date,objects:t}}cut(){this._logger.info("InnoFlowchart.cut()"),this.getSelectedObjects().length!==0&&(mr.saveData(JSON.stringify(this._getClipInfo())),this.removeSelected())}copy(){this._logger.info("InnoFlowchart.copy()"),mr.saveData(JSON.stringify(this._getClipInfo()))}_createPastingObjs(t){if(t.objects.length===0)return;let e=new Map,n=0,o=this._seqMng.getObjSeqId(),i=[];t.objects.forEach(s=>{if(this.getObjectOrNull(s.id)!==null){let a=o+n;for(;this.getObjectOrNull(a)!==null||this.getObjectOrNull(a)!==null&&this.getObjectOrNull(a).type==="connection"&&(this.getObjectOrNull(a).sourceObjId===a||this.getObjectOrNull(a).destinationObjId===a);)a=o+ ++n,this._logger.info("id",a);++n,e.set(s.id,a)}else e.set(s.id,s.id)}),t.objects.forEach(s=>{let a=e.get(s.id);switch(s.type){case"node":{let c=this._getProperlyNodePosToCreate(s);i.push(this.add({...s,...c,id:a,isSelected:!1,isHovered:!1}));break}case"connection":{let c=this._getProperlyPointsToCreate(s);s["connection.sourceObjId"]!==void 0&&s["connection.sourceObjId"]!=null&&e.has(s["connection.sourceObjId"])&&(s["connection.sourceObjId"]=e.get(s["connection.sourceObjId"])),s["connection.destinationObjId"]!==void 0&&s["connection.destinationObjId"]!=null&&e.has(s["connection.destinationObjId"])&&(s["connection.destinationObjId"]=e.get(s["connection.destinationObjId"])),i.push(this.add({...s,id:a,isSelected:!1,points:c}));break}case"group":{i.push(this.add({...s,id:a,isSelected:!1,objectList:s.objectList.map(c=>e.get(c))}));break}default:throw new Error(`Not supported type '${s.type}'`)}}),this.moveScreenByObject(i[0]),this.releaseAllObjects(),i.forEach(s=>{s.select()}),this._actionController.addAction(new Z(xt(i)))}paste(){if(this._editMode||this._appendMode.mode!=null){this._logger.debug("InnoFlowchart.paste()","Could not paste because of edit or append mode");return}this._logger.info("InnoFlowchart.paste()"),this._createPastingObjs(JSON.parse(mr.loadData()))}fitSizeOnText(){this._logger.info("InnoFlowchart.fitSizeOnText()"),this._resizeHandler.resizeDragStart(),this.getSelectedNodes(!1).forEach(t=>{t.resizerEnabled&&t.fitSizeOnText()}),this._resizeHandler.resizeDragEnd()}_getShortestPositions(t,e){let n={dist:Number.MAX_VALUE,sourcePos:"",destinationPos:""};for(let o of _r)for(let i of _r){let s=t.getPositionXY(o),a=e.getPositionXY(i),c=qr(s,a);c<n.dist&&(n.dist=c,n.sourcePos=o,n.destinationPos=i)}return n}_setShortestPosition(t){let e=this.getObjectOrNull(t.sourceObjId),n=this.getObjectOrNull(t.destinationObjId),o=t.sourcePos,i=t.destinationPos;if(e!==null&&n!==null){let s=this._getShortestPositions(e,n);t.sourcePos=s.sourcePos,t.destinationPos=s.destinationPos}else e===null?t.destinationPos=this._getPositionOnSimpleConnecting(t.firstPoint,n):t.sourcePos=this._getPositionOnSimpleConnecting(t.endPoint,e);if(o!==t.sourcePos||i!==t.destinationPos){let s=new X(t.data,[{key:"connection.sourcePos",oldValue:o,newValue:t.sourcePos},{key:"connection.destinationPos",oldValue:i,newValue:t.destinationPos}]);this._actionController.addAction(new V([s]))}}updateShortestConnections(){this._logger.info("InnoFlowchart.updateShortestConnections()");for(let t of this._objectManager.getConnectionIterator())t.isSelected&&this._setShortestPosition(t)}updateShortestNodes(){let t=[];for(let e of this._objectManager.getNodeIterator())if(e.isSelected!==!1)for(let n of this._objectManager.getConnectedConnections(e.id))t.indexOf(n)===-1&&t.push(n);t.forEach(e=>this._setShortestPosition(e))}_getPositionOnSimpleConnecting(t,e){let n={dist:Number.MAX_VALUE,pos:null};for(let o of _r){let i=e.getPositionXY(o),s=qr(i,t);s<n.dist&&(n.dist=s,n.pos=o)}return n.pos}selectType(t){this._logger.info("InnoFlowchart.selectType()",t);let e=t.toLowerCase();this.releaseAllObjects();for(let n of this._objectManager.getAllObjIterator())n.renderType===e&&n.select(!1,e)}clearChangedStatus(){this._isChanged&&(this._isChanged=!1,this.classedOnSvg(!1,"changed"))}clear(){this.clearAppendMode();for(let t of this._objectManager.getAllObjIterator())t.destroy();this._objectManager.clear(),this._seqMng.clear(),this._actionController.clear()}group(t=void 0){let e=t||{};e.type="group",e.render="group",e.objectList=[],Kr(e,this.theme);for(let o of this._objectManager.getSelectedObjIterator())e.objectList.push(o.id);let n=this.add(e);n.resize(),n.select(),this._actionController.addAction(new Z(xt([n])))}ungroup(){let t=[];for(let e of this._objectManager.getGroupIterator())e.isSelected&&(e.clear(),t.push(e),this.remove(e));this._actionController.addAction(new kt(xt(t)))}_moveAppendingNode(t,e){let n=this._getXYOnSheet(t,e);this._appendingObject.data.opacity===0&&(this._appendingObject.data.opacity=.5),this._appendingObject.x=n.x-this._appendingObject.width/2,this._appendingObject.y=n.y-this._appendingObject.height/2}_getSvgXYOnDrag(t,e,n=!1){let o={x:t+this.d3Div.node().scrollLeft,y:e+this.d3Div.node().scrollTop};if(n){let s=1/this.getTransform().k;o.x*=s,o.y*=s}return o}_dragStartHandlerOnSelection(t){let e=this._getSvgXYOnDrag(t.x,t.y);this.selection.rect=this.d3Svg.append("rect").attr("class","selection"),this.selection.startX=e.x,this.selection.startY=e.y}_dragHandlerOnSelection(t){let e=this._getSvgXYOnDrag(t.x,t.y),n=Math.min(e.x,this.selection.startX),o=Math.min(e.y,this.selection.startY),i=Math.max(e.x,this.selection.startX),s=Math.max(e.y,this.selection.startY);this.selection.rect.attr("x",n).attr("y",o).attr("width",i-n).attr("height",s-o)}_dragEndHandlerOnSelection(t){try{let e=this.getTransform(),n=this._getSvgXYOnDrag(t.x,t.y),o=Math.min(n.x,this.selection.startX),i=Math.min(n.y,this.selection.startY),s=Math.max(n.x,this.selection.startX),a=Math.max(n.y,this.selection.startY),c=(l,h,f,u)=>l>=o&&h>=o&&l<=s&&h<=s&&f>=i&&u>=i&&f<=a&&u<=a;this._isSingleSelection(t.sourceEvent.ctrlKey)&&this.releaseAllObjects();for(let l of this._objectManager.getNodeIterator()){let h=l.x*e.k,f=(l.x+l.width)*e.k,u=l.y*e.k,m=(l.y+l.height)*e.k;c(h,f,u,m)&&l.select(!0)}for(let l of this._objectManager.getConnectionIterator()){let h=l.firstPoint,f=l.endPoint,u=Math.min(h.x,f.x)*e.k,m=Math.max(h.x,f.x)*e.k,O=Math.min(h.y,f.y)*e.k,j=Math.max(h.y,f.y)*e.k;c(u,m,O,j)&&l.select(!0)}}finally{this.selection.rect.remove(),this.selection.rect=null,this.$emit(z.MOUSEUP_SHEET,this._getSvgXYOnDrag(t.x,t.y))}}_canvasMoveStartHandler(t){let{offsetX:e,offsetY:n}=t.sourceEvent;this.classedOnSvg(!0,"is-grabbing"),this._cursorStatus={curPosX:e,curPosY:n,isDragging:!0}}_canvasMoveHandler(t){let{curPosX:e,curPosY:n,isDragging:o}=this._cursorStatus;if(!o)return;let{target:i,offsetX:s,offsetY:a}=t.sourceEvent;i===this.d3Svg.node()&&this.div.scrollBy(e-s,n-a)}_canvasMoveEndHandler(t){this._cursorStatus.isDragging=!1,this.classedOnSvg(!1,"is-grabbing"),t.sourceEvent.target===this.d3Svg.node()&&this.releaseAllObjects()}_createAppendObj(){switch(this._appendMode.mode){case"append":{let t=this.add({"node.x":this._appendingObject.x,"node.y":this._appendingObject.y,...this._appendMode.data});this._actionController.addAction(new Z(xt([t])));break}default:break}this.clearAppendMode()}_getAppendNodeDragEventHandler(t){return{start:()=>{},drag:()=>this._moveAppendingNode(t.x+this.div.scrollLeft,t.y+this.div.scrollTop),end:()=>this._createAppendObj()}}_getAppendConnectionDragEventHandler(t){return{start:()=>{let e=this._getSvgXYOnDrag(t.x,t.y,!0);this._createAppendingConnection(e.x,e.y,e.x,e.y,this._appendMode.data),this._appendMode.dragged=!1},drag:()=>{let e=this._getSvgXYOnDrag(t.x,t.y,!0);this._moveAppendingConnection(e.x,e.y,this._appendingObject.renderType),this._appendMode.dragged=!0},end:()=>{this._endAppendingConnection(),this.clearAppendMode()}}}_getAppendModeHandler(t){return{start:()=>this._dragStartHandlerOnSelection(t),drag:()=>this._dragHandlerOnSelection(t),end:()=>this._dragEndHandlerOnSelection(t)}}_getCanvasMoveModeHandler(t){return{start:()=>this._canvasMoveStartHandler(t),drag:()=>this._canvasMoveHandler(t),end:()=>this._canvasMoveEndHandler(t)}}_dragController(t){(()=>{if(this._appendMode.mode==="append")return this._appendMode.data.type==="node"?this._getAppendNodeDragEventHandler(t):this._getAppendConnectionDragEventHandler(t);if(this._canvasMoveMode)return this._getCanvasMoveModeHandler(t);if(this._appendMode.mode===null)return this._getAppendModeHandler(t);throw new Error("unknown drag handler")})()[t.type]()}cancelCreatingConnection(){if(this._appendingObject===null)throw new Error("There is no creatingConnection obj");this.clearAppendMode()}_changeObjRender(t,e){this._renderManager.changeRender(t,e,this._containerInterface),this._addObjectEvent(t)}changeRender(t,e){let n=t.renderType;this._changeObjRender(t,e),this._actionController.addAction(new Lt(t,n,e))}_editTextCallbackHandler(t,e,n){this._logger.debug("InnoFlowchart._editTextCallbackHandler()",`oldText = '${e}'`,`newText = '${n}'`),this._actionController.addAction(new V([new X(t,[{key:"text",oldValue:e,newValue:n}])]))}_moveAppendingConnection(t,e){let n=this._getNodeAndPosUnderXY(t,e,this._simpleConnectingMode);n.node===null||n.node.id===this._appendingObject.sourceObjId?(this._appendingObject.setLastPointXY(t,e),this._appendingObject.destinationObjId=null,this._appendingObject.destinationPos=null):(this._appendingObject.destinationObjId=n.node.id,this._simpleConnectingMode?this._setShortestPosition(this._appendingObject):this._appendingObject.destinationPos=n.pos)}_adjDragStartCallbackHandler(){this._logger.debug("InnoFlowchart.adjDragStartCallbackHandler()"),this._initDrag("drag-adj-move")}_adjDragEndCallbackHandler(t,e,n){this._logger.debug("InnoFlowchart.adjDragEndCallbackHandler()","record undo action"),this._actionController.addAction(new V([new X(t,[{key:"connection.points",oldValue:e,newValue:n}])])),this._terminateDrag("drag-adj-move")}_renderCallBack(t){if(t.type==="node"){let n=new Set;for(let o of this._objectManager.getConnectionIterator())!n.has(o.id)&&(o.sourceObjId===t.id||o.destinationObjId===t.id)&&(n.add(o.id),o.render())}let e=this._objectManager.getParentGroupOrNull(t);e!==null&&e.resize()}_clickOnSheetHandler(t){this.$emit(z.CLICK,this._getXYOnSheet(t.offsetX,t.offsetY))}_createAppendingConnection(t,e,n,o,i){if(this._appendingObject!==null)throw new Error("Already created an appending obj!!");if(!i["connection.sourceObjId"]){let a=this._getNodeAndPosUnderXY(t,e);a.node!==null&&(i["connection.sourceObjId"]=a.node.id,i["connection.sourcePos"]=a.pos)}let s={...i,id:"#temp_appending_connection",type:"connection",opacity:.5,temp:!0,"connection.points":[{x:t,y:e},{x:n,y:o}]};this._appendingObject=this.add(s)}_endAppendingConnection(){let t=this._appendingObject.data;this._appendMode.dragged===!1&&(t=ci(this._appendingObject));let e=this.add({...t,id:void 0,temp:!1,opacity:1});this._actionController.addAction(new Z(xt([e])))}handleKeydownF2(){if(!this._editMode&&this.getCountOfSelectedObject()===1)for(let t of this._objectManager.getSelectedObjIterator()){t.editLabel();return}}handleKeydownDelete(){this.removeSelected()}handleKeydownArrows(t,e){let n=this.getSelectedObjects(!1);n.length>0?this.moveWrapper(()=>{n.filter(o=>o.isSelected).forEach(o=>o.moveTo(t,e))}):(this.div.scrollLeft+=t*2,this.div.scrollTop+=e*2)}handleKeydownEscape(){let t=this._appendMode,e=this._appendingObject;t.mode===null&&e!==null?(this._logger.info("InnoFlowchart.handleKeydownEscape()","Cancel Creating Connection"),this.cancelCreatingConnection()):t.mode!==null?(this._logger.info("InnoFlowchart.handleKeydownEscape()","Clear Appending Data"),this.clearAppendMode()):(this._logger.info("InnoFlowchart.handleKeydownEscape()","releaseAllObj"),this.releaseAllObjects())}};var on={};ki(on,{AddCommand:()=>Z,ChangedInfo:()=>X,DeleteCommand:()=>kt,EditCommand:()=>V,RenderCommand:()=>Lt,ZIndexCommand:()=>$t});export{z as EVENT_TYPE,Ii as IRFlowchart,on as IRFlowchartCommands};
